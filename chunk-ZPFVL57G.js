import{P as xt,Q as Ct,W as bt,c as pt,e as ht,f as mt,m as ft}from"./chunk-U2SYGBHB.js";import{$b as rt,Kb as I,Lb as w,Mb as P,Nb as dt,Nc as ut,Rb as H,Vb as A,Wb as N,Z as W,Za as R,_ as lt,_b as it,ac as st,cb as ct,fc as Z,g as ot,gc as U,ha as k,ia as L,jb as Q,jc as F,kb as gt,pb as nt,rb as j,xa as J}from"./chunk-W7RFCP42.js";import{a as et,e as V}from"./chunk-JKOY2XUY.js";var yt=class S{static \u0275fac=function(e){return new(e||S)};static \u0275mod=gt({type:S});static \u0275inj=lt({imports:[ft,bt]})};var _t=class S{constructor(){}extractTextStreamAsJson(t){return V(this,null,function*(){console.log("[EXTRACT_START] ===== extractTextStreamAsJson \uD568\uC218 \uC2DC\uC791 ====="),console.log("[EXTRACT_START] \uD30C\uC77C:",t.name,"\uD06C\uAE30:",t.size);try{console.log("\u{1F4C4} PDF \uD14D\uC2A4\uD2B8 \uC2A4\uD2B8\uB9BC \uCD94\uCD9C \uC2DC\uC791:",t.name);let e={fileName:t.name,fileSize:t.size,pageCount:0,extractionTimestamp:new Date().toISOString(),extractionMethod:"PDF.js + \uD5A5\uC0C1\uB41C \uBD84\uC11D",pages:[],metadata:{totalTextItems:0,totalWords:0,totalCharacters:0,uniqueFonts:[],hasImages:!1,hasVectorGraphics:!1}},o=yield t.arrayBuffer();if(typeof window.pdfjsLib<"u"){let n=window.pdfjsLib;n.GlobalWorkerOptions.workerSrc||(n.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js");let r=yield n.getDocument({data:o}).promise;console.log("[PDF_LOADED] PDF \uBB38\uC11C \uB85C\uB4DC \uC644\uB8CC, \uD398\uC774\uC9C0 \uC218:",r.numPages);let a=1;e.pageCount=a,console.log(`\u{1F4CA} \uCD1D \uD398\uC774\uC9C0 \uC218: ${r.numPages}, \uBD84\uC11D \uB300\uC0C1: ${a}\uD398\uC774\uC9C0`);let d=new Set,p=0,x=0,l=0;console.log("[PAGE_LOOP] \uD398\uC774\uC9C0 \uCC98\uB9AC \uB8E8\uD504 \uC2DC\uC791"),console.log(`\u{1F512} \uB2E8\uC77C \uD398\uC774\uC9C0 \uBAA8\uB4DC: ${a}\uD398\uC774\uC9C0\uB9CC \uBD84\uC11D\uD569\uB2C8\uB2E4.`);for(let s=1;s<=Math.min(r.numPages,a);s++){console.log(`[PAGE_${s}] ===== \uD398\uC774\uC9C0 ${s} \uCC98\uB9AC \uC2DC\uC791 =====`),console.log(`\u{1F4C4} \uD398\uC774\uC9C0 ${s} \uCC98\uB9AC \uC911...`);let m=yield r.getPage(s);console.log(`[PAGE_${s}] getPage \uC644\uB8CC`);let u=m.getViewport({scale:1});console.log(`[PAGE_${s}] viewport \uC0DD\uC131 \uC644\uB8CC`);let C=yield m.getTextContent();console.log(`[PAGE_${s}] getTextContent \uC644\uB8CC`),console.log(`[TEXT_EXTRACTION] \uD398\uC774\uC9C0 ${s} \uD14D\uC2A4\uD2B8 \uCD94\uCD9C \uC2DC\uC791`),console.log(`[TEXT_EXTRACTION] textContent.items \uAC1C\uC218: ${C.items.length}`),C.items.length>0&&(console.log("[TEXT_STRUCTURE] textContent.items[0] \uD0A4 \uBAA9\uB85D:",Object.keys(C.items[0])),console.log("[TEXT_STRUCTURE] textContent.items[0] \uC0D8\uD50C \uB370\uC774\uD130:",{str:C.items[0].str,fontName:C.items[0].fontName,transform:C.items[0].transform,hasColor:"color"in C.items[0],allKeys:Object.keys(C.items[0])})),console.log("[COLOR_EXTRACTION] \uC0C9\uC0C1 \uCD94\uCD9C \uD568\uC218 \uD638\uCD9C \uC2DC\uC791");let _=[];try{_=yield this.extractTextColorsFromOperatorList(m),console.log(`[COLOR_EXTRACTION] \uC0C9\uC0C1 \uCD94\uCD9C \uC644\uB8CC: ${_.length}\uAC1C`)}catch(c){console.error("[COLOR_EXTRACTION] \uC0C9\uC0C1 \uCD94\uCD9C \uC911 \uC5D0\uB7EC \uBC1C\uC0DD:",c)}if(console.log(`[SUMMARY] \uD398\uC774\uC9C0 ${s}: textContent.items=${C.items.length}\uAC1C, textColors=${_.length}\uAC1C`),_.length>0){console.log("[COLOR_SAMPLES] \uCD94\uCD9C\uB41C \uC0C9\uC0C1 \uC0D8\uD50C (\uCC98\uC74C 10\uAC1C):",_.slice(0,10));let c=[...new Set(_)];console.log(`[COLOR_STATS] \uACE0\uC720 \uC0C9\uC0C1 \uAC1C\uC218: ${c.length}\uAC1C`,c)}else console.warn(`[COLOR_WARNING] \uD398\uC774\uC9C0 ${s}\uC5D0\uC11C \uC0C9\uC0C1\uC774 \uCD94\uCD9C\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4!`);let O=C.items.map((c,b)=>{let f=c.transform,T={id:`page-${s}-item-${b}`,text:c.str,position:{x:Math.round(f[4]*100)/100,y:Math.round((u.height-f[5])*100)/100,width:Math.round(c.width*100)/100,height:Math.round(c.height*100)/100},font:{name:c.fontName||"Unknown",size:Math.round(Math.abs(f[0])*100)/100},transform:f,style:{direction:c.dir||"ltr",hasEndOfLine:c.hasEOL||!1,color:_[b]||"#000000"},analysis:this.analyzeText(c.str)};return b<5&&console.log(`[TEXT_ITEM_${b}] \uD14D\uC2A4\uD2B8: "${c.str.substring(0,30)}" | \uC0C9\uC0C1: ${_[b]||"\uC5C6\uC74C (#000000 \uC0AC\uC6A9)"} | \uD3F0\uD2B8: ${c.fontName}`),c.fontName&&d.add(c.fontName),T}).filter(c=>c.text.trim().length>0),M=this.groupTextIntoSentences(O),y=this.calculatePageStatistics(O),E={pageNumber:s,width:Math.round(u.width),height:Math.round(u.height),textItems:O,sentences:M,statistics:y};e.pages.push(E),p+=O.length,x+=y.wordCount,l+=y.charCount}let h=yield this.checkForVectorGraphics(r),v;if(h)try{v=yield this.extractVectorGraphicsDetails(r)}catch(s){console.warn("\u26A0\uFE0F \uBCA1\uD130 \uADF8\uB798\uD53D \uC0C1\uC138 \uC815\uBCF4 \uCD94\uCD9C \uC2E4\uD328:",s)}return e.metadata={totalTextItems:p,totalWords:x,totalCharacters:l,uniqueFonts:Array.from(d),hasImages:yield this.checkForImages(r),hasVectorGraphics:h,vectorGraphicsDetails:v},console.log("\u2705 \uD14D\uC2A4\uD2B8 \uC2A4\uD2B8\uB9BC \uCD94\uCD9C \uC644\uB8CC"),console.log(`\u{1F4CA} \uD1B5\uACC4: ${p}\uAC1C \uD14D\uC2A4\uD2B8 \uC544\uC774\uD15C, ${x}\uAC1C \uB2E8\uC5B4, ${l}\uAC1C \uBB38\uC790`),e}throw new Error("PDF.js \uB77C\uC774\uBE0C\uB7EC\uB9AC\uB97C \uC0AC\uC6A9\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4")}catch(e){throw console.error("\u274C \uD14D\uC2A4\uD2B8 \uC2A4\uD2B8\uB9BC \uCD94\uCD9C \uC624\uB958:",e),e}})}analyzeText(t){let e=t.trim().split(/\s+/).filter(n=>n.length>0).length,o=t.length;return{wordCount:e,charCount:o,containsEnglish:/[a-zA-Z]/.test(t),containsKorean:/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(t),containsNumbers:/[0-9]/.test(t),containsSpecialChars:/[!@#$%^&*(),.?":{}|<>]/.test(t)}}groupTextIntoSentences(t){let e=[],o={text:"",items:[],x:null,y:null,width:0,height:0};return t.forEach((n,i)=>{if(o.x===null&&(o.x=n.position.x,o.y=n.position.y),o.text+=n.text,o.items.push(n),o.width+=n.position.width,o.height=Math.max(o.height,n.position.height),(n.style.hasEndOfLine||n.text.includes(".")||n.text.includes("!")||n.text.includes("?")||i===t.length-1)&&o.text.trim()){let a=o.text.trim();e.push({id:`sentence-${e.length+1}`,text:a,position:{x:o.x||0,y:o.y||0,width:o.width,height:o.height},itemCount:o.items.length,itemIds:o.items.map(d=>d.id),language:this.detectLanguage(a)}),o={text:"",items:[],x:null,y:null,width:0,height:0}}}),e}detectLanguage(t){let e=/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(t),o=/[a-zA-Z]/.test(t);return e&&o?"mixed":e?"korean":o?"english":"unknown"}calculatePageStatistics(t){let e=t.reduce((r,a)=>r+a.analysis.wordCount,0),o=t.reduce((r,a)=>r+a.analysis.charCount,0),n=t.length>0?t.reduce((r,a)=>r+a.font.size,0)/t.length:0,i={};return t.forEach(r=>{i[r.font.name]=(i[r.font.name]||0)+1}),{totalItems:t.length,wordCount:e,charCount:o,avgFontSize:Math.round(n*100)/100,fontDistribution:i}}checkForImages(t){return V(this,null,function*(){try{for(let e=1;e<=t.numPages;e++){let n=yield(yield t.getPage(e)).getOperatorList({intent:"display"});for(let i=0;i<n.fnArray.length;i++){let r=n.fnArray[i];if(r===window.pdfjsLib.OPS.paintImageXObject||r===window.pdfjsLib.OPS.paintInlineImageXObject)return!0}}}catch(e){console.warn("\uC774\uBBF8\uC9C0 \uD655\uC778 \uC911 \uC624\uB958:",e)}return!1})}checkForVectorGraphics(t){return V(this,null,function*(){try{for(let e=1;e<=t.numPages;e++){let n=yield(yield t.getPage(e)).getOperatorList({intent:"display"});for(let i=0;i<n.fnArray.length;i++){let r=n.fnArray[i];if(r===window.pdfjsLib.OPS.moveTo||r===window.pdfjsLib.OPS.lineTo||r===window.pdfjsLib.OPS.curveTo||r===window.pdfjsLib.OPS.rectangle||r===window.pdfjsLib.OPS.fill||r===window.pdfjsLib.OPS.stroke)return!0}}}catch(e){console.warn("\uBCA1\uD130 \uADF8\uB798\uD53D \uD655\uC778 \uC911 \uC624\uB958:",e)}return!1})}extractVectorGraphicsDetails(t){return V(this,null,function*(){console.log("\u{1F3A8} \uBCA1\uD130 \uADF8\uB798\uD53D \uC0C1\uC138 \uC815\uBCF4 \uCD94\uCD9C \uC2DC\uC791...");let e={totalOperations:0,summary:{totalPaths:0,totalLines:0,totalCurves:0,totalRectangles:0,totalFillOperations:0,totalStrokeOperations:0,totalClipOperations:0},pageDetails:[]};try{for(let o=1;o<=t.numPages;o++){let n=yield t.getPage(o),i=yield n.getOperatorList({intent:"display"}),r={pageNumber:o,operations:[],statistics:{pathCount:0,lineCount:0,curveCount:0,rectangleCount:0,fillCount:0,strokeCount:0,clipCount:0}};for(let d=0;d<i.fnArray.length;d++){let p=i.fnArray[d],x=i.argsArray[d],l=null,h=!1;p===1?(l="moveTo",h=!0,r.statistics.pathCount++,e.summary.totalPaths++):p===2?(l="lineTo",h=!0,r.statistics.lineCount++,e.summary.totalLines++):p>=3&&p<=6?(l="curve",h=!0,r.statistics.curveCount++,e.summary.totalCurves++):p===7?(l="rectangle",h=!0,r.statistics.rectangleCount++,e.summary.totalRectangles++):p===9?(l="closePath",h=!0):p===22?(l="fill",h=!0,r.statistics.fillCount++,e.summary.totalFillOperations++):p===20?(l="stroke",h=!0,r.statistics.strokeCount++,e.summary.totalStrokeOperations++):p===29?(l="clip",h=!0,r.statistics.clipCount++,e.summary.totalClipOperations++):p>=31&&p<=34?(l="matrixTransform",h=!1):p>=10&&p<=12?(l="styleSettings",h=!1):[28,37,42,44,58,59,70,71,91].includes(p)&&(x&&Array.isArray(x)&&x.length>=2&&typeof x[x.length-2]=="number"&&typeof x[x.length-1]=="number"?(l="unknownVectorGraphic",h=!0):(l="unknownOperation",h=!1)),l&&(h||l.includes("Transform")||l.includes("Settings"))&&(r.operations.push({type:l,args:x||[],opCode:p,isVectorGraphic:h,coordinates:this.extractCoordinates(x)}),h&&e.totalOperations++)}r.operations.length>0&&(e.pageDetails.push(r),console.log(`\u{1F4C4} \uD398\uC774\uC9C0 ${o} OperatorList: ${r.operations.length}\uAC1C \uC5F0\uC0B0`)),console.log(`\u{1F3A8} \uD398\uC774\uC9C0 ${o} SVG \uB80C\uB354\uB9C1 \uC911...`);let a=yield this.extractVectorGraphicsFromSVG(n,window.pdfjsLib);console.log(`\u2705 \uD398\uC774\uC9C0 ${o} SVG \uBD84\uC11D:`,{paths:a.totalPaths,lines:a.totalLines,curves:a.totalCurves,fills:a.totalFills}),e.summary.totalPaths+=a.totalPaths,e.summary.totalLines+=a.totalLines,e.summary.totalCurves+=a.totalCurves}return console.log("\u2705 \uBCA1\uD130 \uADF8\uB798\uD53D \uC0C1\uC138 \uBD84\uC11D \uC644\uB8CC:",{totalOperations:e.totalOperations,totalPaths:e.summary.totalPaths,totalPages:e.pageDetails.length}),e}catch(o){throw console.error("\u274C \uBCA1\uD130 \uADF8\uB798\uD53D \uC0C1\uC138 \uC815\uBCF4 \uCD94\uCD9C \uC624\uB958:",o),o}})}extractTextColorsFromOperatorList(t){return V(this,null,function*(){console.log("[OPERATOR_LIST] extractTextColorsFromOperatorList \uD568\uC218 \uC2DC\uC791");try{console.log("[OPERATOR_LIST] getOperatorList \uD638\uCD9C \uC911...");let e=yield t.getOperatorList({intent:"display"});console.log("[OPERATOR_LIST] getOperatorList \uC644\uB8CC");let o=e.fnArray,n=e.argsArray;console.log(`[OPERATOR_LIST] fnArray \uAE38\uC774: ${o.length}, argsArray \uAE38\uC774: ${n.length}`);let i=window.pdfjsLib;if(!i||!i.OPS)return console.error("[OPERATOR_LIST] pdfjsLib.OPS\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4!"),[];let r=i.OPS;console.log("[OPERATOR_LIST] OPS \uAC1D\uCCB4 \uD0A4 \uC0D8\uD50C:",Object.keys(r).slice(0,20)),console.log("[OPERATOR_LIST] \uC0C9\uC0C1 \uAD00\uB828 OPS \uAC12:",{setFillRGBColor:r.setFillRGBColor,setFillGray:r.setFillGray,setFillCMYKColor:r.setFillCMYKColor,setFillColor:r.setFillColor,showText:r.showText,showSpacedText:r.showSpacedText});let a=[],d="#000000",p="DeviceRGB";console.log(`[COLOR_TRACKING] \uC0C9\uC0C1 \uCD94\uCD9C \uC2DC\uC791 - \uCD1D ${o.length}\uAC1C \uC5F0\uC0B0 \uBD84\uC11D`);let x=0,l=0;for(let h=0;h<o.length;h++){let v=o[h],s=n[h];if(v===r.setFillColorSpace)p=s[0]?.name||s[0]||"DeviceRGB",console.log(`[COLOR_SPACE] \uC0C9\uC0C1 \uACF5\uAC04 \uBCC0\uACBD (\uC5F0\uC0B0 ${h}): ${p}`);else if(v===r.setFillRGBColor){x++;try{if(!Array.isArray(s)||s.length<3){console.error(`[RGB_ERROR] setFillRGBColor \uC778\uC790 \uC624\uB958 (\uC5F0\uC0B0 ${h}): args\uB294 \uCD5C\uC18C 3\uAC1C \uC694\uC18C\uB97C \uAC00\uC9C4 \uBC30\uC5F4\uC774\uC5B4\uC57C \uD568`,s);continue}let m=typeof s[0]=="number"?s[0]:parseFloat(s[0]),u=typeof s[1]=="number"?s[1]:parseFloat(s[1]),C=typeof s[2]=="number"?s[2]:parseFloat(s[2]);if(isNaN(m)||isNaN(u)||isNaN(C)){console.error(`[RGB_ERROR] setFillRGBColor \uAC12 \uBCC0\uD658 \uC2E4\uD328 (\uC5F0\uC0B0 ${h}):`,{rawR:m,rawG:u,rawB:C,args:s});continue}let _=Math.max(0,Math.min(255,Math.round(m*255))),O=Math.max(0,Math.min(255,Math.round(u*255))),M=Math.max(0,Math.min(255,Math.round(C*255)));d=`#${_.toString(16).padStart(2,"0")}${O.toString(16).padStart(2,"0")}${M.toString(16).padStart(2,"0")}`,x<=5&&console.log(`[RGB_${x}] \uC5F0\uC0B0 ${h}: [${m.toFixed(3)}, ${u.toFixed(3)}, ${C.toFixed(3)}] \u2192 [${_}, ${O}, ${M}] \u2192 ${d}`)}catch(m){console.error(`[RGB_ERROR] setFillRGBColor \uCC98\uB9AC \uC911 \uC624\uB958 (\uC5F0\uC0B0 ${h}):`,m,s)}}else if(v===r.setFillGray)try{if(!Array.isArray(s)||s.length<1){console.error("\u274C setFillGray \uC778\uC790 \uC624\uB958: args\uB294 \uCD5C\uC18C 1\uAC1C \uC694\uC18C\uB97C \uAC00\uC9C4 \uBC30\uC5F4\uC774\uC5B4\uC57C \uD568",s);continue}let m=typeof s[0]=="number"?s[0]:parseFloat(s[0]);if(isNaN(m)){console.error("\u274C setFillGray \uAC12 \uBCC0\uD658 \uC2E4\uD328:",{rawGray:m,args:s});continue}console.log(`\u{1F3A8} setFillGray RAW value: ${m}`);let u=Math.max(0,Math.min(255,Math.round(m*255)));d=`#${u.toString(16).padStart(2,"0")}${u.toString(16).padStart(2,"0")}${u.toString(16).padStart(2,"0")}`,console.log(`\u{1F3A8} Gray \uC0C9\uC0C1 \uC124\uC815: ${m} \u2192 ${u} \u2192 ${d}`)}catch(m){console.error("\u274C setFillGray \uCC98\uB9AC \uC911 \uC624\uB958:",m,s)}else if(v===r.setFillCMYKColor)try{if(!Array.isArray(s)||s.length<4){console.error("\u274C setFillCMYKColor \uC778\uC790 \uC624\uB958: args\uB294 \uCD5C\uC18C 4\uAC1C \uC694\uC18C\uB97C \uAC00\uC9C4 \uBC30\uC5F4\uC774\uC5B4\uC57C \uD568",s);continue}let m=typeof s[0]=="number"?s[0]:parseFloat(s[0]),u=typeof s[1]=="number"?s[1]:parseFloat(s[1]),C=typeof s[2]=="number"?s[2]:parseFloat(s[2]),_=typeof s[3]=="number"?s[3]:parseFloat(s[3]);if(isNaN(m)||isNaN(u)||isNaN(C)||isNaN(_)){console.error("\u274C setFillCMYKColor \uAC12 \uBCC0\uD658 \uC2E4\uD328:",{c:m,m:u,y:C,k:_,args:s});continue}console.log(`\u{1F3A8} setFillCMYKColor RAW values: C=${m}, M=${u}, Y=${C}, K=${_}`);let O=Math.max(0,Math.min(255,Math.round(255*(1-m)*(1-_)))),M=Math.max(0,Math.min(255,Math.round(255*(1-u)*(1-_)))),y=Math.max(0,Math.min(255,Math.round(255*(1-C)*(1-_))));d=`#${O.toString(16).padStart(2,"0")}${M.toString(16).padStart(2,"0")}${y.toString(16).padStart(2,"0")}`,console.log(`\u{1F3A8} CMYK \uC0C9\uC0C1 \uC124\uC815: [${m}, ${u}, ${C}, ${_}] \u2192 [${O}, ${M}, ${y}] \u2192 ${d}`)}catch(m){console.error("\u274C setFillCMYKColor \uCC98\uB9AC \uC911 \uC624\uB958:",m,s)}else if(v===r.setFillColor)try{if(console.log(`\u{1F3A8} setFillColor \uD638\uCD9C: colorSpace=${p}, args=`,s,`(length: ${s?.length}, types: ${Array.isArray(s)?s.map(m=>typeof m).join(", "):"not array"})`),!Array.isArray(s)){console.error("\u274C setFillColor \uC778\uC790 \uC624\uB958: args\uB294 \uBC30\uC5F4\uC774\uC5B4\uC57C \uD568",s);continue}if(p==="DeviceRGB"&&s.length>=3){let m=typeof s[0]=="number"?s[0]:parseFloat(s[0]),u=typeof s[1]=="number"?s[1]:parseFloat(s[1]),C=typeof s[2]=="number"?s[2]:parseFloat(s[2]);if(isNaN(m)||isNaN(u)||isNaN(C)){console.error("\u274C setFillColor RGB \uAC12 \uBCC0\uD658 \uC2E4\uD328:",{rawR:m,rawG:u,rawB:C,args:s});continue}let _=Math.max(0,Math.min(255,Math.round(m*255))),O=Math.max(0,Math.min(255,Math.round(u*255))),M=Math.max(0,Math.min(255,Math.round(C*255)));d=`#${_.toString(16).padStart(2,"0")}${O.toString(16).padStart(2,"0")}${M.toString(16).padStart(2,"0")}`,console.log(`\u{1F3A8} setFillColor RGB: [${m}, ${u}, ${C}] \u2192 [${_}, ${O}, ${M}] \u2192 ${d}`)}else if(p==="DeviceGray"&&s.length>=1){let m=typeof s[0]=="number"?s[0]:parseFloat(s[0]);if(isNaN(m)){console.error("\u274C setFillColor Gray \uAC12 \uBCC0\uD658 \uC2E4\uD328:",{rawGray:m,args:s});continue}let u=Math.max(0,Math.min(255,Math.round(m*255)));d=`#${u.toString(16).padStart(2,"0")}${u.toString(16).padStart(2,"0")}${u.toString(16).padStart(2,"0")}`,console.log(`\u{1F3A8} setFillColor Gray: ${m} \u2192 ${u} \u2192 ${d}`)}else if(p==="DeviceCMYK"&&s.length>=4){let m=typeof s[0]=="number"?s[0]:parseFloat(s[0]),u=typeof s[1]=="number"?s[1]:parseFloat(s[1]),C=typeof s[2]=="number"?s[2]:parseFloat(s[2]),_=typeof s[3]=="number"?s[3]:parseFloat(s[3]);if(isNaN(m)||isNaN(u)||isNaN(C)||isNaN(_)){console.error("\u274C setFillColor CMYK \uAC12 \uBCC0\uD658 \uC2E4\uD328:",{c:m,m:u,y:C,k:_,args:s});continue}let O=Math.max(0,Math.min(255,Math.round(255*(1-m)*(1-_)))),M=Math.max(0,Math.min(255,Math.round(255*(1-u)*(1-_)))),y=Math.max(0,Math.min(255,Math.round(255*(1-C)*(1-_))));d=`#${O.toString(16).padStart(2,"0")}${M.toString(16).padStart(2,"0")}${y.toString(16).padStart(2,"0")}`,console.log(`\u{1F3A8} setFillColor CMYK: [${m}, ${u}, ${C}, ${_}] \u2192 [${O}, ${M}, ${y}] \u2192 ${d}`)}else console.warn(`\u26A0\uFE0F \uC54C \uC218 \uC5C6\uB294 \uC0C9\uC0C1 \uACF5\uAC04 \uB610\uB294 \uC778\uC790: colorSpace=${p}, args=`,s)}catch(m){console.error("\u274C setFillColor \uCC98\uB9AC \uC911 \uC624\uB958:",m,s)}else if((v===r.showText||v===r.showSpacedText||v===r.nextLineShowText)&&(l++,a.push(d),l<=5)){let m=v===r.showText?"showText":v===r.showSpacedText?"showSpacedText":"nextLineShowText";console.log(`[TEXT_${l}] \uC5F0\uC0B0 ${h} (${m}): \uC0C9\uC0C1=${d}, \uD14D\uC2A4\uD2B8 \uC218\uC9D1 \uC644\uB8CC`)}}if(console.log("[COLOR_TRACKING] \uC0C9\uC0C1 \uCD94\uCD9C \uC644\uB8CC"),console.log(`[COLOR_STATS] \uCD1D \uC0C9\uC0C1 \uBCC0\uACBD: ${x}\uD68C, \uD14D\uC2A4\uD2B8 \uC5F0\uC0B0: ${l}\uAC1C, \uC218\uC9D1\uB41C \uC0C9\uC0C1: ${a.length}\uAC1C`),a.length>0){let h=[...new Set(a)];console.log(`[COLOR_STATS] \uACE0\uC720 \uC0C9\uC0C1: ${h.length}\uAC1C`,h)}return a}catch(e){return console.error("[COLOR_EXTRACTION_ERROR] \uD14D\uC2A4\uD2B8 \uC0C9\uC0C1 \uCD94\uCD9C \uC2E4\uD328:",e),[]}})}extractColorsFromSVG(t){let e=[],o=[],n={};try{let i=t.querySelectorAll("*");console.log(`[SVG_COLOR] SVG \uC694\uC18C \uAC1C\uC218: ${i.length}`),i.forEach((d,p)=>{let x=d.getAttribute("fill");if(x&&x!=="none"&&x!=="transparent"){let h=this.normalizeSVGColor(x);e.push(h),n[h]=(n[h]||0)+1,p<5&&console.log(`[SVG_COLOR] \uC694\uC18C ${p} fill: ${x} \u2192 ${h}`)}let l=d.getAttribute("stroke");if(l&&l!=="none"&&l!=="transparent"){let h=this.normalizeSVGColor(l);o.push(h),p<5&&console.log(`[SVG_COLOR] \uC694\uC18C ${p} stroke: ${l} \u2192 ${h}`)}});let r=[...new Set(e)],a=[...new Set(o)];return console.log(`[SVG_COLOR] Fill \uC0C9\uC0C1: ${e.length}\uAC1C (\uACE0\uC720: ${r.length}\uAC1C)`),console.log(`[SVG_COLOR] Stroke \uC0C9\uC0C1: ${o.length}\uAC1C (\uACE0\uC720: ${a.length}\uAC1C)`),console.log("[SVG_COLOR] \uACE0\uC720 Fill \uC0C9\uC0C1:",r),console.log("[SVG_COLOR] \uACE0\uC720 Stroke \uC0C9\uC0C1:",a),{fillColors:e,strokeColors:o,uniqueFillColors:r,uniqueStrokeColors:a,colorDistribution:n}}catch(i){return console.error("[SVG_COLOR_ERROR] SVG \uC0C9\uC0C1 \uCD94\uCD9C \uC2E4\uD328:",i),{fillColors:[],strokeColors:[],uniqueFillColors:[],uniqueStrokeColors:[],colorDistribution:{}}}}normalizeSVGColor(t){try{if(/^#[0-9a-fA-F]{6}$/.test(t))return t.toLowerCase();if(/^#[0-9a-fA-F]{3}$/.test(t))return`#${t[1]}${t[1]}${t[2]}${t[2]}${t[3]}${t[3]}`.toLowerCase();let e=t.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(e){let n=parseInt(e[1]).toString(16).padStart(2,"0"),i=parseInt(e[2]).toString(16).padStart(2,"0"),r=parseInt(e[3]).toString(16).padStart(2,"0");return`#${n}${i}${r}`}let o=t.match(/rgba\((\d+),\s*(\d+),\s*(\d+),\s*[\d.]+\)/);if(o){let n=parseInt(o[1]).toString(16).padStart(2,"0"),i=parseInt(o[2]).toString(16).padStart(2,"0"),r=parseInt(o[3]).toString(16).padStart(2,"0");return`#${n}${i}${r}`}return console.warn(`[SVG_COLOR] \uC54C \uC218 \uC5C6\uB294 \uC0C9\uC0C1 \uD615\uC2DD: ${t}`),"#000000"}catch(e){return console.error(`[SVG_COLOR] \uC0C9\uC0C1 \uBCC0\uD658 \uC624\uB958: ${t}`,e),"#000000"}}extractTextColorsFromSVG(t){let e=[],o=[];try{let n=t.querySelectorAll("text, tspan");console.log(`[SVG_TEXT_COLOR] \uD14D\uC2A4\uD2B8 \uC694\uC18C \uAC1C\uC218: ${n.length}`),n.forEach((r,a)=>{let d=r.textContent?.trim()||"",p=r.getAttribute("fill");if(!p||p==="none"){let s=r.parentElement;for(;s&&(!p||p==="none");)p=s.getAttribute("fill"),s=s.parentElement}let x=p&&p!=="none"?this.normalizeSVGColor(p):"#000000",l=parseFloat(r.getAttribute("x")||"0"),h=parseFloat(r.getAttribute("y")||"0"),v=r.getAttribute("transform");if(v){let s=v.match(/translate\(([^,]+),\s*([^)]+)\)/);s&&(l+=parseFloat(s[1]),h+=parseFloat(s[2]))}o.push({x:l,y:h,color:x}),d&&e.push({text:d,color:x,x:l,y:h}),a<10&&console.log(`[SVG_TEXT_COLOR] \uC694\uC18C ${a}: (${l.toFixed(2)}, ${h.toFixed(2)}) \u2192 ${x} ${d?`"${d.substring(0,20)}"`:"(\uD14D\uC2A4\uD2B8 \uC5C6\uC74C)"}`)});let i=[...new Set(o.map(r=>r.color))];return console.log(`[SVG_TEXT_COLOR] \uCD1D ${o.length}\uAC1C \uC704\uCE58, \uACE0\uC720 \uC0C9\uC0C1 ${i.length}\uAC1C`,i),{textItems:e,colorsByPosition:o}}catch(n){return console.error("[SVG_TEXT_COLOR_ERROR] SVG \uD14D\uC2A4\uD2B8 \uC0C9\uC0C1 \uCD94\uCD9C \uC2E4\uD328:",n),{textItems:[],colorsByPosition:[]}}}downloadJsonData(t){try{let e=JSON.stringify(t,null,2),o=new Blob([e],{type:"application/json;charset=utf-8;"}),n=document.createElement("a"),i=URL.createObjectURL(o),r=new Date().toISOString().split("T")[0],a=`${t.fileName}_text_stream_${r}.json`;n.setAttribute("href",i),n.setAttribute("download",a),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(i),console.log(`\u2705 JSON \uD30C\uC77C \uB2E4\uC6B4\uB85C\uB4DC \uC644\uB8CC: ${a}`)}catch(e){throw console.error("\u274C JSON \uD30C\uC77C \uB2E4\uC6B4\uB85C\uB4DC \uC624\uB958:",e),e}}logJsonData(t){console.group("\u{1F4C4} PDF \uD14D\uC2A4\uD2B8 \uC2A4\uD2B8\uB9BC JSON \uB370\uC774\uD130"),console.log("\u{1F4CA} \uAE30\uBCF8 \uC815\uBCF4:",{fileName:t.fileName,fileSize:t.fileSize,pageCount:t.pageCount,extractionTimestamp:t.extractionTimestamp}),console.log("\u{1F4C8} \uD1B5\uACC4:",t.metadata),console.log("\uFFFD \uC5B8\uC5B4 \uD1B5\uACC4:",t.metadata.languageDetection),console.log("\uFFFD\u{1F4DD} \uD398\uC774\uC9C0\uBCC4 \uC694\uC57D:",t.pages.map(e=>({page:e.pageNumber,textItems:e.statistics.totalItems,words:e.statistics.wordCount,englishCount:e.statistics.englishTextCount||0,koreanCount:e.statistics.koreanTextCount||0}))),console.log("\u{1F4C4} \uC804\uCCB4 JSON \uB370\uC774\uD130:",t),console.groupEnd()}processFileWithAutoExtraction(t){return V(this,null,function*(){try{console.log("\u{1F680} PDF \uD30C\uC77C \uCC98\uB9AC \uC2DC\uC791 (\uC790\uB3D9 \uD14D\uC2A4\uD2B8 \uC2A4\uD2B8\uB9BC \uCD94\uCD9C):",t.name);let e=yield this.extractTextStreamAsJson(t);this.logJsonData(e);let o=this.generateSummary(e);return console.log(`\u{1F4CB} \uC694\uC57D \uC815\uBCF4:
`+o),e}catch(e){throw console.error("\u274C PDF \uD30C\uC77C \uCC98\uB9AC \uC2E4\uD328:",e),e}})}filterTextByCondition(t,e){let o=[];return t.pages.forEach(n=>{e.pageNumber&&n.pageNumber!==e.pageNumber||n.textItems.forEach(i=>{let r=!0;e.containsEnglish!==void 0&&(r=r&&i.analysis.containsEnglish===e.containsEnglish),e.containsKorean!==void 0&&(r=r&&i.analysis.containsKorean===e.containsKorean),e.minFontSize!==void 0&&(r=r&&i.font.size>=e.minFontSize),e.maxFontSize!==void 0&&(r=r&&i.font.size<=e.maxFontSize),r&&o.push(i)})}),o}generateSummary(t){return[`\u{1F4C4} PDF \uD30C\uC77C: ${t.fileName}`,"\u{1F4CA} \uAE30\uBCF8 \uC815\uBCF4:",`   - \uD30C\uC77C \uD06C\uAE30: ${this.formatFileSize(t.fileSize)}`,`   - \uD398\uC774\uC9C0 \uC218: ${t.pageCount}`,`   - \uCD94\uCD9C \uC2DC\uAC04: ${new Date(t.extractionTimestamp).toLocaleString("ko-KR")}`,"","\u{1F4C8} \uD14D\uC2A4\uD2B8 \uD1B5\uACC4:",`   - \uCD1D \uD14D\uC2A4\uD2B8 \uC544\uC774\uD15C: ${t.metadata.totalTextItems.toLocaleString()}\uAC1C`,`   - \uCD1D \uB2E8\uC5B4 \uC218: ${t.metadata.totalWords.toLocaleString()}\uAC1C`,`   - \uCD1D \uBB38\uC790 \uC218: ${t.metadata.totalCharacters.toLocaleString()}\uAC1C`,`   - \uC0AC\uC6A9\uB41C \uD3F0\uD2B8: ${t.metadata.uniqueFonts.length}\uAC1C`,"","\u{1F5BC}\uFE0F \uBBF8\uB514\uC5B4 \uC694\uC18C:",`   - \uC774\uBBF8\uC9C0 \uD3EC\uD568: ${t.metadata.hasImages?"\uC608":"\uC544\uB2C8\uC624"}`,`   - \uBCA1\uD130 \uADF8\uB798\uD53D \uD3EC\uD568: ${t.metadata.hasVectorGraphics?"\uC608":"\uC544\uB2C8\uC624"}`,"","\u{1F4DD} \uD398\uC774\uC9C0\uBCC4 \uC0C1\uC138:",...t.pages.map(o=>`   \uD398\uC774\uC9C0 ${o.pageNumber}: ${o.statistics.totalItems}\uAC1C \uD14D\uC2A4\uD2B8, ${o.statistics.wordCount}\uB2E8\uC5B4`)].join(`
`)}formatFileSize(t){if(t===0)return"0 Bytes";let e=1024,o=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,n)).toFixed(2))+" "+o[n]}extractVectorStreamData(t){return V(this,null,function*(){console.log("\u{1F3A8} \uBCA1\uD130 \uC2A4\uD2B8\uB9BC \uB370\uC774\uD130 \uCD94\uCD9C \uC2DC\uC791...");let e=yield t.arrayBuffer(),o=yield window.pdfjsLib.getDocument(e).promise,n=1;console.log(`\u{1F512} \uBCA1\uD130 \uC2A4\uD2B8\uB9BC: ${o.numPages}\uD398\uC774\uC9C0 \uC911 ${n}\uD398\uC774\uC9C0\uB9CC \uBD84\uC11D\uD569\uB2C8\uB2E4.`);let i={fileName:t.name.replace(/\.[^/.]+$/,""),fileSize:t.size,pageCount:n,extractionTimestamp:new Date().toISOString(),extractionMethod:"PDF.js OperatorList Analysis (First Page Only)",totalOperations:0,summary:{totalPaths:0,totalLines:0,totalCurves:0,totalRectangles:0,totalFillOperations:0,totalStrokeOperations:0,totalClipOperations:0},pageDetails:[],debugInfo:{totalOperatorsFound:0,recognizedOperators:0,unrecognizedOperators:0,uniqueOperatorCodes:[]}},r=new Set;try{console.log("\u{1F512} \uBCA1\uD130 \uC2A4\uD2B8\uB9BC \uB2E8\uC77C \uD398\uC774\uC9C0 \uBAA8\uB4DC: 1\uD398\uC774\uC9C0\uB9CC \uBD84\uC11D\uD569\uB2C8\uB2E4.");for(let d=1;d<=Math.min(o.numPages,1);d++){let p=yield o.getPage(d),x=yield p.getOperatorList({intent:"display"});i.debugInfo.totalOperatorsFound+=x.fnArray.length,x.fnArray.forEach(b=>r.add(b));let l={pageNumber:d,operations:[],statistics:{pathCount:0,lineCount:0,curveCount:0,rectangleCount:0,fillCount:0,strokeCount:0,clipCount:0}},h=[],v=!1,s=null,m=[],u="#000000",C="#000000",_=[],O=[],M=[],E=window.pdfjsLib.OPS;console.log(`[COLOR_VECTOR] \uD398\uC774\uC9C0 ${d} \uBCA1\uD130 \uC0C9\uC0C1 \uCD94\uC801 \uC2DC\uC791`);for(let b=0;b<x.fnArray.length;b++){let f=x.fnArray[b],g=x.argsArray[b],T="",$=!1;if(f===E.setFillRGBColor){if(g&&g.length>=3){let z=Math.round(g[0]*255),G=Math.round(g[1]*255),D=Math.round(g[2]*255);u=`#${z.toString(16).padStart(2,"0")}${G.toString(16).padStart(2,"0")}${D.toString(16).padStart(2,"0")}`,console.log(`[COLOR_VECTOR] Fill RGB \uC124\uC815: ${u}`)}}else if(f===E.setStrokeRGBColor){if(g&&g.length>=3){let z=Math.round(g[0]*255),G=Math.round(g[1]*255),D=Math.round(g[2]*255);C=`#${z.toString(16).padStart(2,"0")}${G.toString(16).padStart(2,"0")}${D.toString(16).padStart(2,"0")}`,console.log(`[COLOR_VECTOR] Stroke RGB \uC124\uC815: ${C}`)}}else if(f===E.setFillGray){if(g&&g.length>=1){let z=Math.round(g[0]*255);u=`#${z.toString(16).padStart(2,"0")}${z.toString(16).padStart(2,"0")}${z.toString(16).padStart(2,"0")}`,console.log(`[COLOR_VECTOR] Fill Gray \uC124\uC815: ${u}`)}}else if(f===E.setStrokeGray){if(g&&g.length>=1){let z=Math.round(g[0]*255);C=`#${z.toString(16).padStart(2,"0")}${z.toString(16).padStart(2,"0")}${z.toString(16).padStart(2,"0")}`,console.log(`[COLOR_VECTOR] Stroke Gray \uC124\uC815: ${C}`)}}else if(f===30)s&&m.push([...s]),_.push(u),O.push(C);else if(f===31)g&&g.length>=6&&(s=g.slice(0,6)),T="matrixTransform";else if(f===32)m.length>0&&(s=m.pop()||null),_.length>0&&(u=_.pop()),O.length>0&&(C=O.pop());else if(f===1)g&&g.length>=2&&(h.push({type:"moveTo",coords:[g[0],g[1]]}),v=!0),T="moveTo",$=!0,l.statistics.pathCount++,i.summary.totalPaths++;else if(f===2)g&&g.length>=2&&(h.push({type:"lineTo",coords:[g[0],g[1]]}),v=!0),T="lineTo",$=!0,l.statistics.lineCount++,i.summary.totalLines++;else if(f>=3&&f<=6)g&&g.length>=6&&(h.push({type:"curve",coords:g.slice(0,6)}),v=!0),T="curve",$=!0,l.statistics.curveCount++,i.summary.totalCurves++;else if(f===7)g&&g.length>=4&&(h.push({type:"rectangle",coords:[g[0],g[1],g[2],g[3]]}),v=!0),T="rectangle",$=!0,l.statistics.rectangleCount++,i.summary.totalRectangles++;else if(f===9)v&&h.push({type:"closePath",coords:[]}),T="closePath",$=!0;else if(f===22){if(T="fill",$=!0,l.statistics.fillCount++,i.summary.totalFillOperations++,M.push({operation:"fill",fillColor:u,strokeColor:C}),!v&&s){let z=s[4],G=s[5],D=s[0],X=s[3],B=Math.max(Math.abs(D),Math.abs(X),1);h.push({type:"implicitRect",coords:[z,G,B,B]}),v=!0,console.log(`\u{1F538} \uC554\uBB35\uC801 fill path \uC0DD\uC131: (${z.toFixed(2)}, ${G.toFixed(2)}) ${B.toFixed(2)}x${B.toFixed(2)} \uC0C9\uC0C1: ${u}`)}}else f===20?(T="stroke",$=!0,l.statistics.strokeCount++,i.summary.totalStrokeOperations++,M.push({operation:"stroke",fillColor:u,strokeColor:C})):f===29?(T="clip",$=!0,l.statistics.clipCount++,i.summary.totalClipOperations++):f===12?(g&&g.length===6&&(s=g.slice(0,6)),T="styleSettings"):f>=10&&f<=11?T="styleSettings":[28,37,42,44,58,59,70,71,91].includes(f)&&(g&&Array.isArray(g)&&g.length>=2&&typeof g[g.length-2]=="number"&&typeof g[g.length-1]=="number"?(T="unknownVectorGraphic",$=!0):(T="unknownOperation",$=!1));if(T&&($||T.includes("Transform")||T.includes("Settings"))){let z={type:T,args:g||[],opCode:f,opName:this.getOpName(f)||`code_${f}`,isVectorGraphic:$,coordinates:this.extractCoordinates(g)};(T==="fill"||T==="stroke")&&h.length>0&&(z.currentPath=[...h],z.pathSegments=h.length),s&&(z.transformMatrix=[...s]),l.operations.push(z),$&&(i.totalOperations++,i.debugInfo.recognizedOperators++),(T==="fill"||T==="stroke")&&(h=[],v=!1)}else i.debugInfo.unrecognizedOperators++}if(console.log(`\u{1F4C4} \uD398\uC774\uC9C0 ${d} OperatorList: ${l.operations.length}\uAC1C \uC5F0\uC0B0`),M.length>0){let b=[...new Set(M.map(g=>g.fillColor))],f=[...new Set(M.map(g=>g.strokeColor))];console.log(`[COLOR_VECTOR] \uD398\uC774\uC9C0 ${d} \uC0C9\uC0C1 \uD1B5\uACC4:`),console.log(`  - Fill \uC5F0\uC0B0: ${M.filter(g=>g.operation==="fill").length}\uAC1C`),console.log(`  - Stroke \uC5F0\uC0B0: ${M.filter(g=>g.operation==="stroke").length}\uAC1C`),console.log(`  - \uACE0\uC720 Fill \uC0C9\uC0C1: ${b.length}\uAC1C`,b),console.log(`  - \uACE0\uC720 Stroke \uC0C9\uC0C1: ${f.length}\uAC1C`,f),l.colorInfo={colorsByOperation:M,uniqueFillColors:b,uniqueStrokeColors:f,totalFillOperations:M.filter(g=>g.operation==="fill").length,totalStrokeOperations:M.filter(g=>g.operation==="stroke").length}}console.log(`\u{1F3A8}\u{1F3A8}\u{1F3A8} [SVG_GENERATION] \uD398\uC774\uC9C0 ${d} SVG \uC0DD\uC131 \uC2DC\uC791 \u{1F3A8}\u{1F3A8}\u{1F3A8}`);try{console.log("[SVG_GENERATION] viewport \uC0DD\uC131 \uC911...");let b=p.getViewport({scale:1});console.log("[SVG_GENERATION] OperatorList \uCD94\uCD9C \uC911...");let f=yield p.getOperatorList({intent:"display"});console.log("[SVG_GENERATION] SVGGraphics \uAC1D\uCCB4 \uC0DD\uC131 \uC911...");let g=new window.pdfjsLib.SVGGraphics(p.commonObjs,p.objs);console.log("[SVG_GENERATION] getSVG \uD638\uCD9C \uC911...");let T=yield g.getSVG(f,b);console.log("[SVG_GENERATION] SVG \uC0DD\uC131 \uC644\uB8CC! \uD0C0\uC785:",T?.constructor?.name),console.log("\u{1F3A8}\u{1F3A8}\u{1F3A8} [SVG_COLOR] SVG \uC694\uC18C\uC5D0\uC11C \uC0C9\uC0C1 \uCD94\uCD9C \uC2DC\uC791 \u{1F3A8}\u{1F3A8}\u{1F3A8}");let $=this.extractColorsFromSVG(T);console.log("\u{1F3A8}\u{1F3A8}\u{1F3A8} [SVG_COLOR] \uCD94\uCD9C \uC644\uB8CC! \uC0C9\uC0C1 \uC815\uBCF4: \u{1F3A8}\u{1F3A8}\u{1F3A8}",$),console.log("[OPERATOR_COLOR_POSITION] OperatorList\uC5D0\uC11C \uD14D\uC2A4\uD2B8 \uC0C9\uC0C1-\uC704\uCE58 \uCD94\uCD9C \uC2DC\uC791");let z=yield this.extractTextColorsAndPositionsFromOperatorList(p),G=z.colorPositions,D=z.debugInfo;console.log(`[OPERATOR_COLOR_POSITION] \uCD94\uCD9C \uC644\uB8CC: ${G.length}\uAC1C`);let X={textItemsCount:G.length,uniqueTextColors:[...new Set(G.map(q=>q.color))],colorsByPosition:G,debugInfo:D,sampleTextItems:G.slice(0,10).map(q=>({text:"",color:q.color,position:{x:q.x,y:q.y}}))};console.log("[OPERATOR_COLOR_POSITION] textColorInfo \uC0DD\uC131 \uC644\uB8CC:",X),l.svgColorInfo=$,l.textColorInfo=X,console.log("[SVG_COLOR] pageDetail\uC5D0 svgColorInfo \uBC0F textColorInfo \uC800\uC7A5 \uC644\uB8CC");let B=T.querySelectorAll("text, tspan");B.forEach(q=>q.remove()),console.log(`\u{1F5D1}\uFE0F ${B.length}\uAC1C\uC758 \uD14D\uC2A4\uD2B8 \uC694\uC18C \uC81C\uAC70\uB428`);let Y=new XMLSerializer().serializeToString(T);Y=Y.replace(/<svg:svg/g,"<svg").replace(/<\/svg:svg>/g,"</svg>").replace(/<svg:g/g,"<g").replace(/<\/svg:g>/g,"</g>").replace(/<svg:path/g,"<path").replace(/<\/svg:path>/g,"</path>").replace(/<svg:rect/g,"<rect").replace(/<\/svg:rect>/g,"</rect>").replace(/<svg:line/g,"<line").replace(/<\/svg:line>/g,"</line>").replace(/<svg:circle/g,"<circle").replace(/<\/svg:circle>/g,"</circle>").replace(/<svg:ellipse/g,"<ellipse").replace(/<\/svg:ellipse>/g,"</ellipse>").replace(/<svg:polygon/g,"<polygon").replace(/<\/svg:polygon>/g,"</polygon>").replace(/<svg:polyline/g,"<polyline").replace(/<\/svg:polyline>/g,"</polyline>").replace(/<svg:text/g,"<text").replace(/<\/svg:text>/g,"</text>").replace(/<svg:tspan/g,"<tspan").replace(/<\/svg:tspan>/g,"</tspan>").replace(/xmlns:svg="[^"]*"/g,"").replace(/xmlns:xlink="[^"]*"/g,'xmlns:xlink="http://www.w3.org/1999/xlink"').replace(/<svg /g,'<svg xmlns="http://www.w3.org/2000/svg" '),l.svgContent=Y,console.log(`\u2705\u2705\u2705 \uD398\uC774\uC9C0 ${d} SVG \uC0DD\uC131 \uC644\uB8CC (\uAE38\uC774: ${l.svgContent.length}\uC790) \u2705\u2705\u2705`),console.log("\u{1F50D} SVG \uC2DC\uC791 \uBD80\uBD84:",l.svgContent.substring(0,200))}catch(b){console.error(`\u274C\u274C\u274C [SVG_ERROR] \uD398\uC774\uC9C0 ${d} SVG \uC0DD\uC131 \uC2E4\uD328! \u274C\u274C\u274C`,b),console.error("[SVG_ERROR] \uC5D0\uB7EC \uC0C1\uC138:",{message:b.message,stack:b.stack,name:b.name}),l.svgContent=void 0}(l.operations.length>0||l.svgContent)&&(i.pageDetails.push(l),console.log(`\u{1F4E6} \uD398\uC774\uC9C0 ${d} pageDetails\uC5D0 \uCD94\uAC00\uB428 (SVG: ${l.svgContent?"YES":"NO"})`)),console.log(`\u{1F3A8} \uD398\uC774\uC9C0 ${d} SVG \uBD84\uC11D \uC911...`);let c=yield this.extractVectorGraphicsFromSVG(p,window.pdfjsLib);console.log(`\u2705 \uD398\uC774\uC9C0 ${d} SVG \uBD84\uC11D \uC644\uB8CC:`,{paths:c.totalPaths,lines:c.totalLines,curves:c.totalCurves,fills:c.totalFills}),i.summary.totalPaths+=c.totalPaths,i.summary.totalLines+=c.totalLines,i.summary.totalCurves+=c.totalCurves,console.log(`\u{1F4CA} \uD398\uC774\uC9C0 ${d} \uB204\uC801 \uD1B5\uACC4:`,{totalPaths:i.summary.totalPaths,totalLines:i.summary.totalLines,totalCurves:i.summary.totalCurves,totalFills:i.summary.totalFillOperations})}return i.debugInfo.uniqueOperatorCodes=Array.from(r).sort(),i.extractionMethod="PDF.js OperatorList + SVG Rendering (Hybrid)",console.log("\u2705 \uBCA1\uD130 \uC2A4\uD2B8\uB9BC \uB370\uC774\uD130 \uCD94\uCD9C \uC644\uB8CC:",{totalOperations:i.totalOperations,recognizedOperators:i.debugInfo.recognizedOperators,unrecognizedOperators:i.debugInfo.unrecognizedOperators}),i}catch(a){throw console.error("\u274C \uBCA1\uD130 \uC2A4\uD2B8\uB9BC \uB370\uC774\uD130 \uCD94\uCD9C \uC624\uB958:",a),a}})}downloadVectorStreamJson(t){try{let e=JSON.stringify(t,null,2),o=new Blob([e],{type:"application/json;charset=utf-8;"}),n=document.createElement("a"),i=URL.createObjectURL(o),r=new Date().toISOString().split("T")[0],a=`${t.fileName}_vector_stream_${r}.json`;n.setAttribute("href",i),n.setAttribute("download",a),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(i),console.log(`\u2705 \uBCA1\uD130 \uC2A4\uD2B8\uB9BC JSON \uD30C\uC77C \uB2E4\uC6B4\uB85C\uB4DC \uC644\uB8CC: ${a}`)}catch(e){throw console.error("\u274C \uBCA1\uD130 \uC2A4\uD2B8\uB9BC JSON \uD30C\uC77C \uB2E4\uC6B4\uB85C\uB4DC \uC624\uB958:",e),e}}logVectorStreamJson(t){console.group("\u{1F3A8} PDF \uBCA1\uD130 \uC2A4\uD2B8\uB9BC JSON \uB370\uC774\uD130"),console.log("\u{1F4CA} \uAE30\uBCF8 \uC815\uBCF4:",{fileName:t.fileName,fileSize:t.fileSize,pageCount:t.pageCount,extractionTimestamp:t.extractionTimestamp}),console.log("\u{1F4C8} \uBCA1\uD130 \uD1B5\uACC4:",t.summary),console.log("\u{1F50D} \uB514\uBC84\uADF8 \uC815\uBCF4:",t.debugInfo),console.log("\u{1F3A8} \uC804\uCCB4 \uBCA1\uD130 JSON \uB370\uC774\uD130:",t),console.groupEnd()}getOpName(t){return{1:"moveTo",2:"lineTo",3:"curveTo",4:"quadraticCurveTo",5:"bezierCurveTo",6:"arcTo",7:"rectangle",9:"closePath",10:"setLineWidth",11:"setLineCap",12:"setLineJoin",20:"stroke",22:"fill",29:"clip",31:"concat",32:"scale",33:"rotate",34:"translate"}[t]||null}extractCoordinates(t){if(!t||!Array.isArray(t))return null;if(t.length===6&&t.every(o=>typeof o=="number"))return{type:"matrix",x:t[4],y:t[5],transform:[t[0],t[1],t[2],t[3]]};if(t.length===2&&t.every(o=>typeof o=="number"))return{type:"point",x:t[0],y:t[1]};if(t.length===4&&t.every(o=>typeof o=="number"))return{type:"rectangle",x:t[0],y:t[1],width:t[2],height:t[3]};let e=t.filter(o=>typeof o=="number");return e.length>=2?{type:"extracted",x:e[e.length-2],y:e[e.length-1],allNumbers:e}:null}parseSVGPathCommands(t){let e={moveToCount:0,lineToCount:0,curveToCount:0,commands:[]};if(!t||typeof t!="string")return e;let o=/([MLHVCSQTAZmlhvcsqtaz])([^MLHVCSQTAZmlhvcsqtaz]*)/g,n;for(;(n=o.exec(t))!==null;){let i=n[1],r=n[2].trim();if(!r){(i==="Z"||i==="z")&&e.commands.push({type:"closePath",coords:[]});continue}let a=r.replace(/,/g," ").replace(/-/g," -").split(/\s+/).filter(d=>d&&d!=="-").map(d=>parseFloat(d)).filter(d=>!isNaN(d));switch(i.toUpperCase()){case"M":e.moveToCount++,e.commands.push({type:"moveTo",coords:a});break;case"L":e.lineToCount++,e.commands.push({type:"lineTo",coords:a});break;case"H":e.lineToCount++,e.commands.push({type:"hLineTo",coords:a});break;case"V":e.lineToCount++,e.commands.push({type:"vLineTo",coords:a});break;case"C":e.curveToCount++,e.commands.push({type:"curveTo",coords:a});break;case"S":e.curveToCount++,e.commands.push({type:"smoothCurveTo",coords:a});break;case"Q":e.curveToCount++,e.commands.push({type:"quadraticCurveTo",coords:a});break;case"T":e.curveToCount++,e.commands.push({type:"smoothQuadraticCurveTo",coords:a});break;case"A":e.curveToCount++,e.commands.push({type:"arc",coords:a});break;case"Z":e.commands.push({type:"closePath",coords:[]});break}}return e}analyzeSVGPaths(t){let e={totalPaths:0,totalLines:0,totalCurves:0,totalFills:0,pathDetails:[],renderablePaths:[]};return t.querySelectorAll("path").forEach((n,i)=>{let r=n.getAttribute("d");if(!r)return;let a=this.parseSVGPathCommands(r);e.totalPaths+=a.moveToCount,e.totalLines+=a.lineToCount,e.totalCurves+=a.curveToCount;let d=n.getAttribute("fill"),p=n.getAttribute("stroke"),x=d&&d.toLowerCase()!=="none",l=p&&p.toLowerCase()!=="none";(x||l)&&(x&&e.totalFills++,e.renderablePaths.push({element:n,d:r,fill:d,stroke:p,strokeWidth:n.getAttribute("stroke-width"),opacity:n.getAttribute("opacity"),transform:n.getAttribute("transform")})),e.pathDetails.push({pathIndex:i,moveToCount:a.moveToCount,lineToCount:a.lineToCount,curveToCount:a.curveToCount,dAttribute:r.substring(0,100)+(r.length>100?"...":"")})}),e}extractVectorGraphicsFromSVG(t,e){return V(this,null,function*(){try{let o=t.getViewport({scale:1}),n=yield t.getOperatorList({intent:"display"}),r=yield new e.SVGGraphics(t.commonObjs,t.objs).getSVG(n,o),a=this.analyzeSVGPaths(r),p=new XMLSerializer().serializeToString(r);return{totalPaths:a.totalPaths,totalLines:a.totalLines,totalCurves:a.totalCurves,totalFills:a.totalFills,svgString:p.substring(0,500),renderablePaths:a.renderablePaths}}catch(o){return console.error("\u274C SVG \uB80C\uB354\uB9C1 \uC911 \uC624\uB958:",o),{totalPaths:0,totalLines:0,totalCurves:0,totalFills:0,svgString:"",renderablePaths:[]}}})}redrawVectorGraphicsFromSVG(t,e,o){return V(this,null,function*(){try{console.log("\u{1F3A8} SVG \uBCA1\uD130 \uADF8\uB798\uD53D \uC0C8\uB85C\uADF8\uB9AC\uAE30 \uC2DC\uC791...");let n=o.querySelector("canvas");if(!n)return console.error("\u274C \uCE94\uBC84\uC2A4\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4."),{success:!1,totalElementsCreated:0,fillCount:0,strokeCount:0};let i=n.width,r=n.height,a=n.offsetWidth,d=n.offsetHeight;console.log(`\u{1F4D0} \uCE94\uBC84\uC2A4 \uD06C\uAE30: ${i} x ${r}`),console.log(`\u{1F4D0} \uD45C\uC2DC \uD06C\uAE30: ${a} x ${d}`);let p=t.getViewport({scale:1}),x=i/p.width;console.log(`\u{1F4CF} PDF \uC6D0\uBCF8 \uD06C\uAE30: ${p.width} x ${p.height}`),console.log(`\u{1F50D} \uD604\uC7AC \uC2A4\uCF00\uC77C: ${x}`);let l=t.getViewport({scale:x}),h=yield t.getOperatorList({intent:"display"}),s=yield new e.SVGGraphics(t.commonObjs,t.objs).getSVG(h,l);console.log("\u{1F50D} \uC0DD\uC131\uB41C SVG \uC804\uCCB4 \uAD6C\uC870:"),console.log("SVG \uD06C\uAE30:",l.width,"x",l.height),console.log("SVG \uC790\uC2DD \uC694\uC18C \uAC1C\uC218:",s.children.length),Array.from(s.children).forEach((O,M)=>{let y=O;if(console.log(`
\u{1F4E6} \uC694\uC18C ${M+1}:`,y.tagName),y.tagName==="path"){let E=y;console.log("  - d:",E.getAttribute("d")?.substring(0,100)+"..."),console.log("  - fill:",E.getAttribute("fill")),console.log("  - stroke:",E.getAttribute("stroke")),console.log("  - transform:",E.getAttribute("transform"))}else y.tagName==="g"&&(console.log("  - transform:",y.getAttribute("transform")),console.log("  - \uC790\uC2DD \uAC1C\uC218:",y.children.length),Array.from(y.children).forEach((E,c)=>{let b=E;if(b.tagName==="path"){let f=b;console.log(`    \u2022 path ${c+1}:`),console.log("      - d:",f.getAttribute("d")?.substring(0,80)+"..."),console.log("      - fill:",f.getAttribute("fill")),console.log("      - stroke:",f.getAttribute("stroke"))}}))});let m=this.analyzeSVGPaths(s);if(m.renderablePaths.length===0)return console.warn("\u26A0\uFE0F \uB80C\uB354\uB9C1 \uAC00\uB2A5\uD55C \uBCA1\uD130 \uC694\uC18C\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4."),{success:!1,totalElementsCreated:0,fillCount:0,strokeCount:0};console.log(`
\u{1F4CA} \uB80C\uB354\uB9C1 \uAC00\uB2A5\uD55C \uBCA1\uD130 \uC694\uC18C: ${m.renderablePaths.length}\uAC1C`),console.log(`   - fill \uC694\uC18C: ${m.totalFills}\uAC1C`);let u=o.querySelector(".vector-graphics-overlay");u?(u.innerHTML="",u.style.width=`${a}px`,u.style.height=`${d}px`,u.setAttribute("viewBox",`0 0 ${l.width} ${l.height}`)):(u=document.createElementNS("http://www.w3.org/2000/svg","svg"),u.classList.add("vector-graphics-overlay"),u.style.position="absolute",u.style.top="0",u.style.left="0",u.style.width=`${a}px`,u.style.height=`${d}px`,u.style.pointerEvents="none",u.style.zIndex="10",u.setAttribute("viewBox",`0 0 ${l.width} ${l.height}`),u.setAttribute("preserveAspectRatio","xMidYMid meet"),o.style.position="relative",o.appendChild(u));let C=0,_=0;return m.renderablePaths.forEach((O,M)=>{try{let y=document.createElementNS("http://www.w3.org/2000/svg","path");y.setAttribute("d",O.d),O.fill&&(y.setAttribute("fill",O.fill),C++),O.stroke&&(y.setAttribute("stroke",O.stroke),_++),O.strokeWidth&&y.setAttribute("stroke-width",O.strokeWidth),O.opacity&&y.setAttribute("opacity",O.opacity),O.transform&&y.setAttribute("transform",O.transform),y.classList.add("vector-path"),y.setAttribute("data-path-index",M.toString()),u.appendChild(y)}catch(y){console.error(`\u274C Path ${M} \uC0DD\uC131 \uC2E4\uD328:`,y)}}),console.log(`\u2705 \uBCA1\uD130 \uC694\uC18C \uC0DD\uC131 \uC644\uB8CC: ${m.renderablePaths.length}\uAC1C`),console.log(`   - fill: ${C}\uAC1C, stroke: ${_}\uAC1C`),{success:!0,totalElementsCreated:m.renderablePaths.length,fillCount:C,strokeCount:_}}catch(n){return console.error("\u274C \uBCA1\uD130 \uADF8\uB798\uD53D \uC0C8\uB85C\uADF8\uB9AC\uAE30 \uC2E4\uD328:",n),{success:!1,totalElementsCreated:0,fillCount:0,strokeCount:0}}})}redrawAllPagesVectorGraphics(t,e,o){return V(this,null,function*(){try{console.log("\u{1F3A8}\u{1F3A8}\u{1F3A8} \uC804\uCCB4 \uD398\uC774\uC9C0 \uBCA1\uD130 \uADF8\uB798\uD53D \uC0C8\uB85C\uADF8\uB9AC\uAE30 \uC2DC\uC791...");let n=t.numPages,i=0,r=0,a=0;for(let d=1;d<=n;d++){let p=yield t.getPage(d),x=o.querySelector(`.page[data-page-number="${d}"]`);if(!x){console.warn(`\u26A0\uFE0F \uD398\uC774\uC9C0 ${d} DOM \uC694\uC18C\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.`);continue}let l=yield this.redrawVectorGraphicsFromSVG(p,e,x);l.success&&(i+=l.totalElementsCreated,r+=l.fillCount,a+=l.strokeCount)}console.log("\u2705\u2705\u2705 \uC804\uCCB4 \uD398\uC774\uC9C0 \uBCA1\uD130 \uADF8\uB798\uD53D \uC0C8\uB85C\uADF8\uB9AC\uAE30 \uC644\uB8CC!"),console.log(`\u{1F4CA} \uCD1D \uC0DD\uC131\uB41C \uC694\uC18C: ${i}\uAC1C`),console.log(`   - fill: ${r}\uAC1C`),console.log(`   - stroke: ${a}\uAC1C`)}catch(n){throw console.error("\u274C \uC804\uCCB4 \uD398\uC774\uC9C0 \uBCA1\uD130 \uADF8\uB798\uD53D \uC0C8\uB85C\uADF8\uB9AC\uAE30 \uC2E4\uD328:",n),n}})}viewVectorGraphicsAsSVG(t,e,o){return V(this,null,function*(){try{console.log(`\u{1F5BC}\uFE0F \uD398\uC774\uC9C0 ${o} \uBCA1\uD130 \uADF8\uB798\uD53D SVG \uC0DD\uC131 \uC911...`);let n=t.getViewport({scale:2}),i=n.width,r=n.height,a=yield t.getOperatorList({intent:"display"}),p=yield new e.SVGGraphics(t.commonObjs,t.objs).getSVG(a,n),l=new XMLSerializer().serializeToString(p);l.includes("viewBox")||(l=l.replace("<svg",`<svg viewBox="0 0 ${i} ${r}"`));let h=`
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>\uD398\uC774\uC9C0 ${o} - \uBCA1\uD130 \uADF8\uB798\uD53D</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header h1 {
            font-size: 24px;
            color: #333;
            margin-bottom: 10px;
        }
        .info {
            color: #666;
            font-size: 14px;
        }
        .info-item {
            display: inline-block;
            margin-right: 20px;
            margin-bottom: 5px;
        }
        .svg-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: auto;
        }
        svg {
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
        }
        .controls {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        button:hover {
            background: #0056b3;
        }
        button.secondary {
            background: #6c757d;
        }
        button.secondary:hover {
            background: #545b62;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>\u{1F4CA} PDF \uBCA1\uD130 \uADF8\uB798\uD53D - \uD398\uC774\uC9C0 ${o}</h1>
        <div class="info">
            <span class="info-item">\u{1F4D0} \uD06C\uAE30: ${i.toFixed(2)} \xD7 ${r.toFixed(2)}</span>
            <span class="info-item">\u{1F50D} \uC2A4\uCF00\uC77C: 2.0x</span>
            <span class="info-item">\u{1F4C5} \uC0DD\uC131: ${new Date().toLocaleString("ko-KR")}</span>
        </div>
    </div>

    <div class="controls">
        <button onclick="downloadSVG()">\u{1F4BE} SVG \uB2E4\uC6B4\uB85C\uB4DC</button>
        <button onclick="copyToClipboard()" class="secondary">\u{1F4CB} SVG \uCF54\uB4DC \uBCF5\uC0AC</button>
        <button onclick="toggleGrid()" class="secondary">\u{1F4CF} \uADF8\uB9AC\uB4DC \uD1A0\uAE00</button>
    </div>

    <div class="svg-container" id="svgContainer">
        ${l}
    </div>

    <script>
        function downloadSVG() {
            const svgElement = document.querySelector('svg');
            const serializer = new XMLSerializer();
            const svgString = serializer.serializeToString(svgElement);
            const blob = new Blob([svgString], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'page_${o}_vector_graphics.svg';
            a.click();
            URL.revokeObjectURL(url);
        }

        function copyToClipboard() {
            const svgElement = document.querySelector('svg');
            const serializer = new XMLSerializer();
            const svgString = serializer.serializeToString(svgElement);
            navigator.clipboard.writeText(svgString).then(() => {
                console.log('\u2705 SVG \uCF54\uB4DC\uAC00 \uD074\uB9BD\uBCF4\uB4DC\uC5D0 \uBCF5\uC0AC\uB418\uC5C8\uC2B5\uB2C8\uB2E4!');
            }).catch(err => {
                console.error('\uBCF5\uC0AC \uC2E4\uD328:', err);
            });
        }

        let gridVisible = false;
        function toggleGrid() {
            const container = document.getElementById('svgContainer');
            if (gridVisible) {
                container.style.backgroundImage = 'none';
                gridVisible = false;
            } else {
                container.style.backgroundImage = 
                    'linear-gradient(rgba(0,0,0,.1) 1px, transparent 1px),' +
                    'linear-gradient(90deg, rgba(0,0,0,.1) 1px, transparent 1px)';
                container.style.backgroundSize = '20px 20px';
                gridVisible = true;
            }
        }
    <\/script>
</body>
</html>
      `,v=window.open("","_blank");v?(v.document.write(h),v.document.close(),console.log("\u2705 SVG \uBCA1\uD130 \uADF8\uB798\uD53D\uC774 \uC0C8 \uCC3D\uC5D0 \uD45C\uC2DC\uB418\uC5C8\uC2B5\uB2C8\uB2E4!")):console.error("\u274C \uD31D\uC5C5\uC774 \uCC28\uB2E8\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uD31D\uC5C5 \uD5C8\uC6A9 \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.")}catch(n){throw console.error("\u274C SVG \uC0DD\uC131 \uC2E4\uD328:",n),n}})}downloadAllPagesVectorGraphicsAsSVG(t,e){return V(this,null,function*(){try{console.log("\u{1F4E6} \uBAA8\uB4E0 \uD398\uC774\uC9C0\uC758 \uBCA1\uD130 \uADF8\uB798\uD53D SVG \uC0DD\uC131 \uC911...");let o=t.numPages,n="";for(let p=1;p<=o;p++){let x=yield t.getPage(p),l=x.getViewport({scale:2}),h=yield x.getOperatorList({intent:"display"}),s=yield new e.SVGGraphics(x.commonObjs,x.objs).getSVG(h,l),u=new XMLSerializer().serializeToString(s);n+=`
<!-- \uD398\uC774\uC9C0 ${p} -->
${u}
`}let i=`
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>\uC804\uCCB4 \uD398\uC774\uC9C0 \uBCA1\uD130 \uADF8\uB798\uD53D</title>
    <style>
        body { margin: 20px; background: #f5f5f5; }
        .page { background: white; margin-bottom: 40px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        h2 { margin: 0 0 20px 0; color: #333; }
        svg { max-width: 100%; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <h1>\u{1F4DA} PDF \uBCA1\uD130 \uADF8\uB798\uD53D (\uC804\uCCB4 ${o}\uD398\uC774\uC9C0)</h1>
    ${n}
</body>
</html>
      `,r=new Blob([i],{type:"text/html"}),a=URL.createObjectURL(r),d=document.createElement("a");d.href=a,d.download=`all_pages_vector_graphics_${Date.now()}.html`,d.click(),URL.revokeObjectURL(a),console.log("\u2705 \uBAA8\uB4E0 \uD398\uC774\uC9C0\uC758 \uBCA1\uD130 \uADF8\uB798\uD53D\uC774 \uB2E4\uC6B4\uB85C\uB4DC\uB418\uC5C8\uC2B5\uB2C8\uB2E4!")}catch(o){throw console.error("\u274C \uC804\uCCB4 \uD398\uC774\uC9C0 SVG \uB2E4\uC6B4\uB85C\uB4DC \uC2E4\uD328:",o),o}})}extractTextColorsAndPositionsFromOperatorList(t){return V(this,null,function*(){try{let e=yield t.getOperatorList({intent:"display"}),o=t.getViewport({scale:1}),n=e.fnArray,i=e.argsArray,r=window.pdfjsLib;if(!r||!r.OPS)return console.error("[OPERATOR_LIST] pdfjsLib.OPS\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4!"),{colorPositions:[],debugInfo:{totalOperations:0,colorChangeCount:0,textOperationCount:0,opsCodeCheck:{},colorChanges:[],textOperations:[]}};let a=r.OPS,d=[],p=[],x=[],l="#000000",h=[1,0,0,1,0,0],v="DeviceRGB",s=0,m=0,u=!1,C="#000000",_=[],O={setFillRGBColor:a.setFillRGBColor,setFillGray:a.setFillGray,setFillColorSpace:a.setFillColorSpace,showText:a.showText,showSpacedText:a.showSpacedText,beginText:a.beginText,endText:a.endText};console.log(`[COLOR_POSITION] \uC0C9\uC0C1-\uC704\uCE58 \uCD94\uCD9C \uC2DC\uC791 - \uCD1D ${n.length}\uAC1C \uC5F0\uC0B0 \uBD84\uC11D`),console.log("[COLOR_POSITION] OPS \uCF54\uB4DC \uD655\uC778:",O);for(let y=0;y<n.length;y++){let E=n[y],c=i[y];if(E===a.beginText){u=!0;continue}else if(E===a.endText){u=!1;continue}if(E===a.transform){let[b,f,g,T,$,z]=c,[G,D,X,B,at,Y]=h;h=[b*G+f*X,b*D+f*B,g*G+T*X,g*D+T*B,$*G+z*X+at,$*D+z*B+Y]}else E===a.setTextMatrix&&(h=c.slice());if(E===a.setFillColorSpace){let b=c[0]?.name||c[0]||"DeviceRGB";b!==v&&(console.log(`[COLOR_SPACE_CHANGE] ${v} \u2192 ${b} (\uC5F0\uC0B0 ${y})`),v=b)}else if(E===a.setFillRGBColor){if(s++,s<=10&&_.push({changeNumber:s,operationIndex:y,type:"setFillRGBColor",argsIsArray:Array.isArray(c),argsLength:c?.length,argsValue:c,argsType:typeof c,isInTextObject:u}),c&&c.length>=3){let b=c[0]<=1&&c[1]<=1&&c[2]<=1,f=b?Math.max(0,Math.min(255,Math.round(c[0]*255))):Math.max(0,Math.min(255,Math.round(c[0]))),g=b?Math.max(0,Math.min(255,Math.round(c[1]*255))):Math.max(0,Math.min(255,Math.round(c[1]))),T=b?Math.max(0,Math.min(255,Math.round(c[2]*255))):Math.max(0,Math.min(255,Math.round(c[2]))),$=`#${f.toString(16).padStart(2,"0")}${g.toString(16).padStart(2,"0")}${T.toString(16).padStart(2,"0")}`;l=$,u&&(C=$,p.push({index:y,type:"setFillRGBColor",color:$,args:[c[0],c[1],c[2]]})),s<=10&&console.log(`[COLOR_RGB_${s}] \uC5F0\uC0B0 ${y}: [${c[0]}, ${c[1]}, ${c[2]}] \u2192 ${$} (normalized=${b}, inText=${u})`)}}else if(E===a.setFillGray){if(s++,s<=10&&_.push({changeNumber:s,operationIndex:y,type:"setFillGray",argsIsArray:Array.isArray(c),argsLength:c?.length,argsValue:c,argsType:typeof c,isInTextObject:u}),c&&c.length>=1){let b=c[0]<=1,f=b?Math.max(0,Math.min(255,Math.round(c[0]*255))):Math.max(0,Math.min(255,Math.round(c[0]))),g=`#${f.toString(16).padStart(2,"0")}${f.toString(16).padStart(2,"0")}${f.toString(16).padStart(2,"0")}`;l=g,u&&(C=g,p.push({index:y,type:"setFillGray",color:g,args:[c[0]]})),s<=10&&console.log(`[COLOR_GRAY_${s}] \uC5F0\uC0B0 ${y}: ${c[0]} \u2192 ${g} (normalized=${b}, inText=${u})`)}}else if(E===a.setFillCMYKColor){if(c&&c.length>=4){let[b,f,g,T]=c,$=Math.max(0,Math.min(255,Math.round(255*(1-b)*(1-T)))),z=Math.max(0,Math.min(255,Math.round(255*(1-f)*(1-T)))),G=Math.max(0,Math.min(255,Math.round(255*(1-g)*(1-T)))),D=`#${$.toString(16).padStart(2,"0")}${z.toString(16).padStart(2,"0")}${G.toString(16).padStart(2,"0")}`;l=D,u&&(C=D)}}else if(E===a.setFillColor){if(c){let b=l;if(v==="DeviceRGB"&&c.length>=3){let f=c[0]<=1&&c[1]<=1&&c[2]<=1,g=f?Math.max(0,Math.min(255,Math.round(c[0]*255))):Math.max(0,Math.min(255,Math.round(c[0]))),T=f?Math.max(0,Math.min(255,Math.round(c[1]*255))):Math.max(0,Math.min(255,Math.round(c[1]))),$=f?Math.max(0,Math.min(255,Math.round(c[2]*255))):Math.max(0,Math.min(255,Math.round(c[2])));b=`#${g.toString(16).padStart(2,"0")}${T.toString(16).padStart(2,"0")}${$.toString(16).padStart(2,"0")}`}else if(v==="DeviceGray"&&c.length>=1){let g=c[0]<=1?Math.max(0,Math.min(255,Math.round(c[0]*255))):Math.max(0,Math.min(255,Math.round(c[0])));b=`#${g.toString(16).padStart(2,"0")}${g.toString(16).padStart(2,"0")}${g.toString(16).padStart(2,"0")}`}l=b,u&&(C=b)}}else if(E===a.showText||E===a.showSpacedText||E===a.nextLineShowText){m++;let b=h[4],f=o.height-h[5],g=E===a.showText?"showText":E===a.showSpacedText?"showSpacedText":"nextLineShowText";d.push({x:b,y:f,color:C}),x.push({index:y,type:g,x:b,y:f,color:C}),m<=10&&console.log(`[COLOR_POSITION_${m}] \uC5F0\uC0B0 ${y} (${g}): (${b.toFixed(2)}, ${f.toFixed(2)}) \u2192 ${C} (inText=${u})`)}}console.log(`[COLOR_POSITION] \uCD94\uCD9C \uC644\uB8CC: ${d.length}\uAC1C \uD14D\uC2A4\uD2B8-\uC0C9\uC0C1-\uC704\uCE58 \uC30D`),console.log(`[COLOR_POSITION] \uC0C9\uC0C1 \uBCC0\uACBD: ${s}\uD68C, \uD14D\uC2A4\uD2B8 \uC5F0\uC0B0: ${m}\uAC1C`);let M=[...new Set(d.map(y=>y.color))];return console.log(`[COLOR_POSITION] \uACE0\uC720 \uC0C9\uC0C1: ${M.length}\uAC1C`,M),{colorPositions:d,debugInfo:{totalOperations:n.length,colorChangeCount:s,textOperationCount:m,opsCodeCheck:O,colorChanges:p.slice(0,20),textOperations:x.slice(0,20),argsCheckLog:_}}}catch(e){return console.error("[COLOR_POSITION_ERROR] \uC0C9\uC0C1-\uC704\uCE58 \uCD94\uCD9C \uC2E4\uD328:",e),{colorPositions:[],debugInfo:{totalOperations:0,colorChangeCount:0,textOperationCount:0,opsCodeCheck:{},colorChanges:[],textOperations:[]}}}})}static \u0275fac=function(e){return new(e||S)};static \u0275prov=W({token:S,factory:S.\u0275fac,providedIn:"root"})};var St=class S{constructor(){}deletePages(t,e){return V(this,null,function*(){try{let n=yield(yield fetch(t)).arrayBuffer(),i=yield PDFLib.PDFDocument.load(n),r=i.getPageCount();console.log(`\uC6D0\uBCF8 PDF \uD398\uC774\uC9C0 \uC218: ${r}`),console.log(`\uC0AD\uC81C\uD560 \uD398\uC774\uC9C0: ${e.join(", ")}`);let a=[...e].sort((l,h)=>h-l);for(let l of a)if(l<1||l>r)throw new Error(`\uD398\uC774\uC9C0 ${l}\uB294 \uC720\uD6A8\uD558\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4. (\uCD1D ${r}\uD398\uC774\uC9C0)`);for(let l of a){let h=l-1;i.removePage(h),console.log(`\uD398\uC774\uC9C0 ${l} \uC0AD\uC81C \uC644\uB8CC`)}let d=yield i.save(),p=new Blob([d],{type:"application/pdf"}),x=URL.createObjectURL(p);return console.log(`\uD398\uC774\uC9C0 \uC0AD\uC81C \uC644\uB8CC. \uB0A8\uC740 \uD398\uC774\uC9C0 \uC218: ${i.getPageCount()}`),x}catch(o){throw console.error("PDF \uD398\uC774\uC9C0 \uC0AD\uC81C \uC911 \uC624\uB958 \uBC1C\uC0DD:",o),o}})}getPageCount(t){return V(this,null,function*(){try{let o=yield(yield fetch(t)).arrayBuffer();return(yield PDFLib.PDFDocument.load(o)).getPageCount()}catch(e){throw console.error("PDF \uD398\uC774\uC9C0 \uC218 \uD655\uC778 \uC911 \uC624\uB958 \uBC1C\uC0DD:",e),e}})}static \u0275fac=function(e){return new(e||S)};static \u0275prov=W({token:S,factory:S.\u0275fac,providedIn:"root"})};var Tt=class S{textEditorsSubject=new ot([]);activeEditorIdSubject=new ot(null);textEditors$=this.textEditorsSubject.asObservable();activeEditorId$=this.activeEditorIdSubject.asObservable();idCounter=0;constructor(){}createTextEditor(t=100,e=100){let o=`text-editor-${++this.idCounter}`,n={id:o,x:t,y:e,width:200,height:100,rotation:0,text:""},i=this.textEditorsSubject.value;return this.textEditorsSubject.next([...i,n]),this.setActiveEditor(o),o}addTextEditor(t){let e=this.textEditorsSubject.value;this.textEditorsSubject.next([...e,t])}updateTextEditor(t,e){let n=this.textEditorsSubject.value.map(i=>i.id===t?et(et({},i),e):i);this.textEditorsSubject.next(n)}deleteTextEditor(t){let o=this.textEditorsSubject.value.filter(n=>n.id!==t);this.textEditorsSubject.next(o),this.activeEditorIdSubject.value===t&&this.setActiveEditor(null)}setActiveEditor(t){this.activeEditorIdSubject.next(t)}getActiveEditor(){return this.activeEditorIdSubject.value}getTextEditor(t){return this.textEditorsSubject.value.find(e=>e.id===t)}getAllTextEditors(){return this.textEditorsSubject.value}getAllActiveEditors(){return this.textEditorsSubject.value}clearAllTextEditors(){this.textEditorsSubject.next([]),this.setActiveEditor(null)}exportTextEditors(){return JSON.stringify(this.textEditorsSubject.value,null,2)}importTextEditors(t){try{let e=JSON.parse(t);return Array.isArray(e)?(this.textEditorsSubject.next(e),this.setActiveEditor(null),!0):!1}catch(e){return console.error("Failed to import text editors:",e),!1}}static \u0275fac=function(e){return new(e||S)};static \u0275prov=W({token:S,factory:S.\u0275fac,providedIn:"root"})};var tt=class S{constructor(t){this.cdr=t}textEditor;position={x:0,y:0};cssClass="";fontSizeChange=new j;fontFamilyChange=new j;boldToggle=new j;italicToggle=new j;underlineToggle=new j;textAlignChange=new j;colorChange=new j;ngOnInit(){console.log("PdfTextEditorToolbarComponent ngOnInit")}ngOnChanges(t){console.log("PdfTextEditorToolbarComponent ngOnChanges:",t),t.textEditor&&(console.log("textEditor changed:",t.textEditor.currentValue),this.cdr.detectChanges()),t.position&&console.log("position changed:",t.position.currentValue)}onFontSizeChange(t){let e=t.target,o=parseInt(e.value,10);this.fontSizeChange.emit({editor:this.textEditor,fontSize:o})}onFontFamilyChange(t){let o=t.target.value;this.fontFamilyChange.emit({editor:this.textEditor,fontFamily:o})}onBoldToggle(){this.boldToggle.emit(this.textEditor)}onItalicToggle(){this.italicToggle.emit(this.textEditor)}onUnderlineToggle(){this.underlineToggle.emit(this.textEditor)}onTextAlignChange(t){this.textAlignChange.emit({editor:this.textEditor,align:t})}onColorChange(t){let o=t.target.value;this.colorChange.emit({editor:this.textEditor,color:o})}static \u0275fac=function(e){return new(e||S)(ct(ut))};static \u0275cmp=Q({type:S,selectors:[["app-pdf-text-adder-toolbar"]],inputs:{textEditor:"textEditor",position:"position",cssClass:"cssClass"},outputs:{fontSizeChange:"fontSizeChange",fontFamilyChange:"fontFamilyChange",boldToggle:"boldToggle",italicToggle:"italicToggle",underlineToggle:"underlineToggle",textAlignChange:"textAlignChange",colorChange:"colorChange"},standalone:!1,features:[J],decls:50,vars:20,consts:[[1,"text-style-toolbar",3,"ngClass"],[1,"toolbar-group"],["type","number","min","8","max","72","step","1",3,"change","value"],[3,"change","value"],["value","Arial"],["value","Helvetica"],["value","Times New Roman"],["value","Courier New"],["value","Georgia"],["value","Verdana"],["value","NanumGothicLocal"],["value","'Pretendard Variable', 'Pretendard'"],["value","'Noto Sans KR'"],["value","'Pretendard Variable', 'Pretendard', 'Noto Sans KR', 'NanumGothicLocal', 'NanumGothic', '\uB098\uB214\uACE0\uB515', sans-serif"],["title","\uAD75\uAC8C",3,"click"],["title","\uAE30\uC6B8\uC784",3,"click"],["title","\uBC11\uC904",3,"click"],["title","\uC67C\uCABD \uC815\uB82C",3,"click"],["title","\uAC00\uC6B4\uB370 \uC815\uB82C",3,"click"],["title","\uC624\uB978\uCABD \uC815\uB82C",3,"click"],["type","color",3,"change","value"]],template:function(e,o){e&1&&(w(0,"div",0)(1,"div",1)(2,"label"),F(3,"\uD06C\uAE30:"),P(),w(4,"input",2),A("change",function(i){return o.onFontSizeChange(i)}),P()(),w(5,"div",1)(6,"label"),F(7,"\uD3F0\uD2B8:"),P(),w(8,"select",3),A("change",function(i){return o.onFontFamilyChange(i)}),w(9,"option",4),F(10,"Arial"),P(),w(11,"option",5),F(12,"Helvetica"),P(),w(13,"option",6),F(14,"Times New Roman"),P(),w(15,"option",7),F(16,"Courier New"),P(),w(17,"option",8),F(18,"Georgia"),P(),w(19,"option",9),F(20,"Verdana"),P(),w(21,"option",10),F(22,"\uB098\uB214\uACE0\uB515"),P(),w(23,"option",11),F(24,"Pretendard"),P(),w(25,"option",12),F(26,"Noto Sans KR"),P(),w(27,"option",13),F(28,"\uAE30\uBCF8 \uD55C\uAE00\uD3F0\uD2B8"),P()()(),w(29,"div",1)(30,"button",14),A("click",function(){return o.onBoldToggle()}),w(31,"strong"),F(32,"B"),P()(),w(33,"button",15),A("click",function(){return o.onItalicToggle()}),w(34,"em"),F(35,"I"),P()(),w(36,"button",16),A("click",function(){return o.onUnderlineToggle()}),w(37,"u"),F(38,"U"),P()()(),w(39,"div",1)(40,"button",17),A("click",function(){return o.onTextAlignChange("left")}),F(41," \u2261 "),P(),w(42,"button",18),A("click",function(){return o.onTextAlignChange("center")}),F(43," \u2261 "),P(),w(44,"button",19),A("click",function(){return o.onTextAlignChange("right")}),F(45," \u2261 "),P()(),w(46,"div",1)(47,"label"),F(48,"\uC0C9\uC0C1:"),P(),w(49,"input",20),A("change",function(i){return o.onColorChange(i)}),P()()()),e&2&&(Z("left",o.position.x,"px")("top",o.position.y,"px"),I("ngClass",o.cssClass),R(4),I("value",o.textEditor.fontSize),R(4),I("value",o.textEditor.fontFamily),R(22),U("active",o.textEditor.bold),R(3),U("active",o.textEditor.italic),R(3),U("active",o.textEditor.underline),R(4),U("active",o.textEditor.textAlign==="left"),R(2),U("active",o.textEditor.textAlign==="center"),R(2),U("active",o.textEditor.textAlign==="right"),R(5),I("value",o.textEditor.color))},dependencies:[pt,xt,Ct],styles:['@charset "UTF-8";.text-style-toolbar[_ngcontent-%COMP%]{position:absolute;background:#fff;border:1px solid #ddd;border-radius:4px;padding:8px;display:flex;gap:12px;align-items:center;box-shadow:0 2px 8px #00000026;z-index:1001;font-size:12px;white-space:nowrap}.text-style-toolbar[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}.text-style-toolbar[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:12px;color:#666;white-space:nowrap}.text-style-toolbar[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{width:50px;padding:2px 4px;border:1px solid #ddd;border-radius:2px;font-size:12px}.text-style-toolbar[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:2px 4px;border:1px solid #ddd;border-radius:2px;font-size:12px;min-width:80px;background:#fff}.text-style-toolbar[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]   input[type=color][_ngcontent-%COMP%]{width:30px;height:24px;border:1px solid #ddd;border-radius:2px;cursor:pointer;padding:0}.text-style-toolbar[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:4px 8px;border:1px solid #ddd;background:#fff;border-radius:2px;cursor:pointer;font-size:12px;min-width:24px}.text-style-toolbar[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#f5f5f5}.text-style-toolbar[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:#007acc;color:#fff;border-color:#007acc}.text-style-toolbar.inline[_ngcontent-%COMP%]{position:relative;border-radius:4px 4px 0 0;box-shadow:0 -2px 8px #0000001a;padding:6px 8px;gap:8px;font-size:11px}.text-style-toolbar.inline[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]{gap:3px}.text-style-toolbar.inline[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:11px}.text-style-toolbar.inline[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{width:45px;font-size:11px}.text-style-toolbar.inline[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{font-size:11px;min-width:70px}.text-style-toolbar.inline[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]   input[type=color][_ngcontent-%COMP%]{width:24px;height:20px}.text-style-toolbar.inline[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:3px 6px;font-size:10px;min-width:20px}.text-style-toolbar.floating[_ngcontent-%COMP%]{position:fixed;z-index:2000;box-shadow:0 4px 12px #0003}.text-style-toolbar.modifier[_ngcontent-%COMP%]{position:absolute;z-index:1500;box-shadow:0 4px 12px #0003}.text-style-toolbar.compact[_ngcontent-%COMP%]{padding:4px 6px;gap:6px;font-size:11px}.text-style-toolbar.compact[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]{gap:2px}.toolbar-group[_ngcontent-%COMP%]   button[title*=\\c815\\b82c][_ngcontent-%COMP%]{position:relative}.toolbar-group[_ngcontent-%COMP%]   button[title*=\\c815\\b82c][title*=\\c67c\\cabd][_ngcontent-%COMP%]{text-align:left}.toolbar-group[_ngcontent-%COMP%]   button[title*=\\c815\\b82c][title*=\\ac00\\c6b4\\b370][_ngcontent-%COMP%]{text-align:center}.toolbar-group[_ngcontent-%COMP%]   button[title*=\\c815\\b82c][title*=\\c624\\b978\\cabd][_ngcontent-%COMP%]{text-align:right}']})};var Mt=["textEditor"],Et=["textarea"];function $t(S,t){if(S&1){let e=H();w(0,"div",16),A("mousedown",function(n){k(e);let i=N();return L(i.startResize(n,"nw"))}),P()}}function zt(S,t){if(S&1){let e=H();w(0,"div",17),A("mousedown",function(n){k(e);let i=N();return L(i.startResize(n,"ne"))}),P()}}function At(S,t){if(S&1){let e=H();w(0,"div",18),A("mousedown",function(n){k(e);let i=N();return L(i.startResize(n,"sw"))}),P()}}function Ft(S,t){if(S&1){let e=H();w(0,"div",19),A("mousedown",function(n){k(e);let i=N();return L(i.startResize(n,"se"))}),P()}}function Rt(S,t){if(S&1){let e=H();w(0,"div",20),A("mousedown",function(n){k(e);let i=N();return L(i.startResize(n,"n"))}),P()}}function kt(S,t){if(S&1){let e=H();w(0,"div",21),A("mousedown",function(n){k(e);let i=N();return L(i.startResize(n,"s"))}),P()}}function Lt(S,t){if(S&1){let e=H();w(0,"div",22),A("mousedown",function(n){k(e);let i=N();return L(i.startResize(n,"w"))}),P()}}function Gt(S,t){if(S&1){let e=H();w(0,"div",23),A("mousedown",function(n){k(e);let i=N();return L(i.startResize(n,"e"))}),P()}}function Vt(S,t){if(S&1){let e=H();w(0,"app-pdf-text-adder-toolbar",24),A("fontSizeChange",function(n){k(e);let i=N();return L(i.onToolbarFontSizeChange(n))})("fontFamilyChange",function(n){k(e);let i=N();return L(i.onToolbarFontFamilyChange(n))})("boldToggle",function(n){k(e);let i=N();return L(i.onToolbarBoldToggle(n))})("italicToggle",function(n){k(e);let i=N();return L(i.onToolbarItalicToggle(n))})("underlineToggle",function(n){k(e);let i=N();return L(i.onToolbarUnderlineToggle(n))})("textAlignChange",function(n){k(e);let i=N();return L(i.onToolbarTextAlignChange(n))})("colorChange",function(n){k(e);let i=N();return L(i.onToolbarColorChange(n))}),P()}if(S&2){let e=N();I("textEditor",e.convertToTextEditor())("position",e.toolbarPosition)}}var wt=class S{config={id:"",x:100,y:100,width:200,height:100,rotation:0,text:"",font:{name:"Arial",size:14}};isVisible=!1;containerWidth=800;containerHeight=600;configChange=new j;close=new j;delete=new j;deactivate=new j;textEditor;textarea;toolbarPosition={x:0,y:0};showToolbar=!1;isDragging=!1;isResizing=!1;isRotating=!1;dragStart={x:0,y:0};resizeHandle="";initialRotation=0;initialAngle=0;resizeObserver;ngOnInit(){this.config.id||(this.config.id="text-editor-"+Date.now()),this.resizeObserver=new ResizeObserver(()=>{this.constrainPosition()})}ngOnChanges(t){if(t.config&&t.config.currentValue){let e=t.config.currentValue;e.isActive!==void 0&&(console.log(`\uD14D\uC2A4\uD2B8 \uC5D0\uB514\uD130 ${e.id} \uD65C\uC131\uD654 \uC0C1\uD0DC \uBCC0\uACBD:`,e.isActive),e.isActive?this.showToolbarForEditor():this.showToolbar=!1)}}ngOnDestroy(){this.resizeObserver?.disconnect()}ngAfterViewInit(){this.textarea&&this.config.text&&setTimeout(()=>{this.autoResizeTextarea(this.textarea.nativeElement)},0)}onMouseDown(t){t.preventDefault(),t.stopPropagation();let e=t.target;e.tagName!=="TEXTAREA"&&(e.classList.contains("resize-handle")?this.startResize(t,e.dataset.handle||""):e.classList.contains("rotate-handle")?this.startRotate(t):this.startDrag(t))}startDrag(t){t.preventDefault(),t.stopPropagation(),this.isDragging=!0,this.dragStart={x:t.clientX-this.config.x,y:t.clientY-this.config.y},document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}startResize(t,e){t.preventDefault(),t.stopPropagation(),this.isResizing=!0,this.resizeHandle=e,this.dragStart={x:t.clientX,y:t.clientY},document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}startRotate(t){t.preventDefault(),t.stopPropagation(),this.isRotating=!0,this.initialRotation=this.config.rotation;let e=this.textEditor.nativeElement.getBoundingClientRect(),o=e.left+e.width/2,n=e.top+e.height/2;this.initialAngle=Math.atan2(t.clientY-n,t.clientX-o)*180/Math.PI,document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp),document.body.style.cursor="grabbing"}onMouseMove=t=>{this.isDragging?(this.config.x=t.clientX-this.dragStart.x,this.config.y=t.clientY-this.dragStart.y,this.constrainPosition()):this.isResizing?this.handleResize(t):this.isRotating&&this.handleRotate(t),this.configChange.emit(this.config),this.showToolbar&&this.updateToolbarPosition()};onMouseUp=()=>{this.isDragging=!1,this.isResizing=!1,this.isRotating=!1,this.resizeHandle="",document.body.style.cursor="",document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)};handleResize(t){let e=t.clientX-this.dragStart.x,o=t.clientY-this.dragStart.y;switch(this.resizeHandle){case"nw":this.config.x+=e,this.config.y+=o,this.config.width-=e,this.config.height-=o;break;case"ne":this.config.y+=o,this.config.width+=e,this.config.height-=o;break;case"sw":this.config.x+=e,this.config.width-=e,this.config.height+=o;break;case"se":this.config.width+=e,this.config.height+=o;break;case"n":this.config.y+=o,this.config.height-=o;break;case"s":this.config.height+=o;break;case"w":this.config.x+=e,this.config.width-=e;break;case"e":this.config.width+=e;break}this.config.width=Math.max(50,this.config.width),this.config.height=Math.max(30,this.config.height),this.dragStart={x:t.clientX,y:t.clientY},this.constrainPosition()}handleRotate(t){let e=this.textEditor.nativeElement.getBoundingClientRect(),o=e.left+e.width/2,n=e.top+e.height/2,r=Math.atan2(t.clientY-n,t.clientX-o)*180/Math.PI-this.initialAngle;this.config.rotation=(this.initialRotation+r)%360,this.config.rotation<0&&(this.config.rotation+=360)}constrainPosition(){this.config.x=Math.max(0,Math.min(this.containerWidth-this.config.width,this.config.x)),this.config.y=Math.max(0,Math.min(this.containerHeight-this.config.height,this.config.y))}onTextChange(t){let e=t.target,o=this.config.text;if(this.config.text=e.value,console.log("=== \uD14D\uC2A4\uD2B8 \uC5D0\uB514\uD130 \uBCC0\uACBD \uAC10\uC9C0 ==="),console.log("\uC5D0\uB514\uD130 ID:",this.config.id),console.log("\uC774\uC804 \uD14D\uC2A4\uD2B8:",o),console.log("\uC0C8 \uD14D\uC2A4\uD2B8:",this.config.text),console.log("\uC6D0\uBCF8 \uD14D\uC2A4\uD2B8:",this.config.originalText),this.config.originalText!==void 0){let n=this.config.isModified;this.config.isModified=this.config.text.trim()!==this.config.originalText.trim(),console.log("\uC218\uC815 \uC0C1\uD0DC \uBCC0\uACBD:",n,"\u2192",this.config.isModified),console.log("\uD14D\uC2A4\uD2B8 \uBE44\uAD50:",{current:`"${this.config.text.trim()}"`,original:`"${this.config.originalText.trim()}"`,equal:this.config.text.trim()===this.config.originalText.trim()}),n!==this.config.isModified&&(console.log(`\u{1F504} \uC5D0\uB514\uD130 ${this.config.id} \uC218\uC815 \uC0C1\uD0DC \uBCC0\uACBD: ${n} \u2192 ${this.config.isModified}`),this.config.isModified?console.log(`\u{1F4DD} \uC5D0\uB514\uD130 ${this.config.id}\uAC00 \uC218\uC815\uB428\uC73C\uB85C \uD45C\uC2DC\uB428 (\uC800\uC7A5 \uB300\uC0C1\uC5D0 \uD3EC\uD568\uB428)`):console.log(`\u{1F504} \uC5D0\uB514\uD130 ${this.config.id}\uAC00 \uC6D0\uBCF8\uC73C\uB85C \uB418\uB3CC\uC544\uAC10`))}this.autoResizeTextarea(e),console.log("\uC0C1\uC704 \uCEF4\uD3EC\uB10C\uD2B8\uB85C \uBCC0\uACBD\uC0AC\uD56D \uC804\uB2EC \uC911..."),this.configChange.emit(this.config),console.log("=== \uD14D\uC2A4\uD2B8 \uC5D0\uB514\uD130 \uBCC0\uACBD \uCC98\uB9AC \uC644\uB8CC ===")}autoResizeTextarea(t){let e=t.style.height;t.style.height="auto";let o=this.config.font?.size||14,n=Math.max(o*1.5+16,30),i=t.scrollHeight,r=Math.max(i,n);this.config.height=r,t.style.height=r+"px",this.configChange.emit(this.config)}onTextareaMouseDown(t){t.stopPropagation()}onTextareaClick(t){t.stopPropagation();let e=t.target;if(this.config.isActive)e.focus(),this.showToolbarForEditor();else{let o=new CustomEvent("activate-text-editor",{detail:{editorId:this.config.id}});document.dispatchEvent(o)}}onClose(){this.close.emit()}onDelete(){this.delete.emit(this.config.id)}onDeactivate(){this.deactivate.emit(this.config.id)}focusTextarea(){this.textarea&&this.textarea.nativeElement.focus()}getTransform(){return`translate(${this.config.x}px, ${this.config.y}px) rotate(${this.config.rotation}deg)`}getTextareaStyle(){let t=this.config.font?.name||"Arial",e=this.config.font?.size||14,o=this.config.font?.color||"#000000",n=this.config.font?.weight||"normal",i=this.config.font?.style||"normal",r=this.config.font?.letterSpacing||0,a=this.config.font?.lineHeight||1.2;return{fontSize:`${e}px`,fontFamily:'"Pretendard Variable", "Pretendard", "Noto Sans KR", "NanumGothicLocal", "NanumGothic", "\uB098\uB214\uACE0\uB515", sans-serif',color:o,fontWeight:n,fontStyle:i,letterSpacing:`${r}px`,lineHeight:a,fontKerning:"auto",fontVariantLigatures:"common-ligatures",fontFeatureSettings:'"kern" 1',textSizeAdjust:"100%",WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale",textRendering:"optimizeLegibility",fontStretch:"semi-condensed",transform:"scaleX(0.97)",wordBreak:"keep-all",overflowWrap:"break-word",backgroundColor:"rgba(255, 255, 255, 0.9)",width:"100%",height:"100%",border:"none",outline:"none",resize:"none",overflow:"hidden",padding:"2px 4px",margin:"0",boxSizing:"border-box"}}isTextModified(){return this.config.originalText?this.config.text.trim()!==this.config.originalText.trim():!1}convertToTextEditor(){return{id:this.config.id,x:this.config.x,y:this.config.y,width:this.config.width,height:this.config.height,text:this.config.text,fontSize:this.config.font?.size||14,fontFamily:this.config.font?.name||"Arial",color:this.config.font?.color||"#000000",bold:this.config.font?.weight==="bold"||this.config.font?.weight==="700",italic:this.config.font?.style==="italic",underline:!1,textAlign:"left",zIndex:1e3}}showToolbarForEditor(){this.config.isActive&&(this.showToolbar=!0,this.updateToolbarPosition())}updateToolbarPosition(){let t=this.containerWidth||800,e=this.containerHeight||600,o=400,n=50,i=this.config.x,r=this.config.y;r=this.config.y-n-10,i+o>t-20&&(i=t-o-20),r<10&&(r=this.config.y+this.config.height+10),r+n>e-20&&(r=e-n-20),i<10&&(i=10),this.toolbarPosition={x:i,y:r}}onToolbarFontSizeChange(t){this.config.font?this.config.font.size=t.fontSize:this.config.font={name:"Arial",size:t.fontSize},this.configChange.emit(this.config)}onToolbarFontFamilyChange(t){this.config.font?this.config.font.name=t.fontFamily:this.config.font={name:t.fontFamily,size:14},this.configChange.emit(this.config)}onToolbarBoldToggle(t){this.config.font?this.config.font.weight=t.bold?"bold":"normal":this.config.font={name:"Arial",size:14,weight:t.bold?"bold":"normal"},this.configChange.emit(this.config)}onToolbarItalicToggle(t){this.config.font?this.config.font.style=t.italic?"italic":"normal":this.config.font={name:"Arial",size:14,style:t.italic?"italic":"normal"},this.configChange.emit(this.config)}onToolbarUnderlineToggle(t){console.log("Underline toggle not supported in TextEditorConfig")}onToolbarTextAlignChange(t){console.log("Text align change not supported in TextEditorConfig")}onToolbarColorChange(t){this.config.font?this.config.font.color=t.color:this.config.font={name:"Arial",size:14,color:t.color},this.configChange.emit(this.config)}static \u0275fac=function(e){return new(e||S)};static \u0275cmp=Q({type:S,selectors:[["app-pdf-text-modifier"]],viewQuery:function(e,o){if(e&1&&(it(Mt,5),it(Et,5)),e&2){let n;rt(n=st())&&(o.textEditor=n.first),rt(n=st())&&(o.textarea=n.first)}},inputs:{config:"config",isVisible:"isVisible",containerWidth:"containerWidth",containerHeight:"containerHeight"},outputs:{configChange:"configChange",close:"close",delete:"delete",deactivate:"deactivate"},standalone:!1,features:[J],decls:17,vars:30,consts:[["textEditor",""],["textarea",""],[1,"text-editor-container"],["title","\uB4DC\uB798\uADF8\uD558\uC5EC \uC774\uB3D9",1,"drag-handle",3,"mousedown"],[1,"drag-indicator"],["placeholder","\uD14D\uC2A4\uD2B8\uB97C \uC785\uB825\uD558\uC138\uC694...",1,"text-input",3,"input","mousedown","click","ngStyle","value","readonly"],[1,"border"],["class","resize-handle nw","data-handle","nw",3,"mousedown",4,"ngIf"],["class","resize-handle ne","data-handle","ne",3,"mousedown",4,"ngIf"],["class","resize-handle sw","data-handle","sw",3,"mousedown",4,"ngIf"],["class","resize-handle se","data-handle","se",3,"mousedown",4,"ngIf"],["class","resize-handle n","data-handle","n",3,"mousedown",4,"ngIf"],["class","resize-handle s","data-handle","s",3,"mousedown",4,"ngIf"],["class","resize-handle w","data-handle","w",3,"mousedown",4,"ngIf"],["class","resize-handle e","data-handle","e",3,"mousedown",4,"ngIf"],["cssClass","modifier",3,"textEditor","position","fontSizeChange","fontFamilyChange","boldToggle","italicToggle","underlineToggle","textAlignChange","colorChange",4,"ngIf"],["data-handle","nw",1,"resize-handle","nw",3,"mousedown"],["data-handle","ne",1,"resize-handle","ne",3,"mousedown"],["data-handle","sw",1,"resize-handle","sw",3,"mousedown"],["data-handle","se",1,"resize-handle","se",3,"mousedown"],["data-handle","n",1,"resize-handle","n",3,"mousedown"],["data-handle","s",1,"resize-handle","s",3,"mousedown"],["data-handle","w",1,"resize-handle","w",3,"mousedown"],["data-handle","e",1,"resize-handle","e",3,"mousedown"],["cssClass","modifier",3,"fontSizeChange","fontFamilyChange","boldToggle","italicToggle","underlineToggle","textAlignChange","colorChange","textEditor","position"]],template:function(e,o){if(e&1){let n=H();w(0,"div",2,0)(2,"div",3),A("mousedown",function(r){return k(n),L(o.startDrag(r))}),w(3,"div",4),F(4,"\u22EE\u22EE"),P()(),w(5,"textarea",5,1),A("input",function(r){return k(n),L(o.onTextChange(r))})("mousedown",function(r){return k(n),L(o.onTextareaMouseDown(r))})("click",function(r){return k(n),L(o.onTextareaClick(r))}),P(),dt(7,"div",6),nt(8,$t,1,0,"div",7)(9,zt,1,0,"div",8)(10,At,1,0,"div",9)(11,Ft,1,0,"div",10)(12,Rt,1,0,"div",11)(13,kt,1,0,"div",12)(14,Lt,1,0,"div",13)(15,Gt,1,0,"div",14),P(),nt(16,Vt,1,2,"app-pdf-text-adder-toolbar",15)}e&2&&(Z("display",o.isVisible?"block":"none")("transform",o.getTransform())("width",o.config.width,"px")("height",o.config.height,"px"),U("dragging",o.isDragging)("resizing",o.isResizing)("rotating",o.isRotating)("text-modified",o.isTextModified())("active-editor",o.config.isActive),R(5),I("ngStyle",o.getTextareaStyle())("value",o.config.text)("readonly",!o.config.isActive),R(3),I("ngIf",o.config.isActive),R(),I("ngIf",o.config.isActive),R(),I("ngIf",o.config.isActive),R(),I("ngIf",o.config.isActive),R(),I("ngIf",o.config.isActive),R(),I("ngIf",o.config.isActive),R(),I("ngIf",o.config.isActive),R(),I("ngIf",o.config.isActive),R(),I("ngIf",o.showToolbar&&o.config.isActive))},dependencies:[ht,mt,tt],styles:[".text-editor-container[_ngcontent-%COMP%]{position:absolute;min-width:50px;min-height:30px;z-index:1000;-webkit-user-select:none;user-select:none;box-sizing:border-box}.text-editor-container[_ngcontent-%COMP%]:hover   .resize-handle[_ngcontent-%COMP%], .text-editor-container[_ngcontent-%COMP%]:hover   .rotate-handle[_ngcontent-%COMP%], .text-editor-container[_ngcontent-%COMP%]:hover   .control-panel[_ngcontent-%COMP%], .text-editor-container[_ngcontent-%COMP%]:hover   .drag-handle[_ngcontent-%COMP%]{opacity:1}.text-editor-container.text-modified[_ngcontent-%COMP%]   .border[_ngcontent-%COMP%]{border-color:#ffc107;box-shadow:0 0 4px #ffc10780}.text-editor-container[_ngcontent-%COMP%]:not(.active-editor):hover   .resize-handle[_ngcontent-%COMP%], .text-editor-container[_ngcontent-%COMP%]:not(.active-editor):hover   .rotate-handle[_ngcontent-%COMP%], .text-editor-container[_ngcontent-%COMP%]:not(.active-editor):hover   .control-panel[_ngcontent-%COMP%], .text-editor-container[_ngcontent-%COMP%]:not(.active-editor):hover   .drag-handle[_ngcontent-%COMP%]{opacity:0}.drag-handle[_ngcontent-%COMP%]{position:absolute;top:50%;left:-25px;transform:translateY(-50%);width:15px;height:30px;background:#b2b2b2;border:1px solid #fff;border-radius:4px 0 0 4px;display:flex;align-items:center;justify-content:center;cursor:move;opacity:0;transition:opacity .2s ease;z-index:2;color:#fff;font-size:10px}.drag-handle[_ngcontent-%COMP%]   .drag-indicator[_ngcontent-%COMP%]{font-weight:700;line-height:1;transform:rotate(90deg)}.drag-handle[_ngcontent-%COMP%]:hover{background:#323232}.text-input[_ngcontent-%COMP%]{position:absolute;top:0;left:0;border:none;outline:none;resize:none;background:transparent;z-index:1;cursor:text;overflow:hidden;word-wrap:break-word;white-space:pre-wrap}.text-input[readonly][_ngcontent-%COMP%]{cursor:pointer;background-color:#fffc;color:#333}.border[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;box-sizing:border-box;border:2px solid #007ACC}.resize-handle[_ngcontent-%COMP%]{position:absolute;background:#007acc;border:1px solid #fff;opacity:0;transition:opacity .2s ease;z-index:2}.resize-handle.nw[_ngcontent-%COMP%], .resize-handle.ne[_ngcontent-%COMP%], .resize-handle.sw[_ngcontent-%COMP%], .resize-handle.se[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%}.resize-handle.n[_ngcontent-%COMP%], .resize-handle.s[_ngcontent-%COMP%]{width:20px;height:6px;left:50%;transform:translate(-50%)}.resize-handle.w[_ngcontent-%COMP%], .resize-handle.e[_ngcontent-%COMP%]{width:6px;height:20px;top:50%;transform:translateY(-50%)}.resize-handle.nw[_ngcontent-%COMP%]{top:-4px;left:-4px;cursor:nw-resize}.resize-handle.ne[_ngcontent-%COMP%]{top:-4px;right:-4px;cursor:ne-resize}.resize-handle.sw[_ngcontent-%COMP%]{bottom:-4px;left:-4px;cursor:sw-resize}.resize-handle.se[_ngcontent-%COMP%]{bottom:-4px;right:-4px;cursor:se-resize}.resize-handle.n[_ngcontent-%COMP%]{top:-3px;cursor:n-resize}.resize-handle.s[_ngcontent-%COMP%]{bottom:-3px;cursor:s-resize}.resize-handle.w[_ngcontent-%COMP%]{left:-3px;cursor:w-resize}.resize-handle.e[_ngcontent-%COMP%]{right:-3px;cursor:e-resize}.rotate-handle[_ngcontent-%COMP%]{position:absolute;top:-30px;left:50%;transform:translate(-50%);width:24px;height:24px;background:#ffc107;border:1px solid #fff;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:grab;opacity:0;transition:opacity .2s ease;z-index:2;color:#212529}.rotate-handle[_ngcontent-%COMP%]:active{cursor:grabbing}.rotate-handle[_ngcontent-%COMP%]:hover{background:#e0a800}.rotate-handle[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:14px;height:14px}.control-panel[_ngcontent-%COMP%]{position:absolute;bottom:-35px;right:-5px;background:#fffffff2;border:1px solid #ccc;border-radius:4px;padding:4px;opacity:0;transition:opacity .2s ease;z-index:3;box-shadow:0 2px 8px #00000026}.control-panel[_ngcontent-%COMP%]   .control-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;gap:4px}.btn-close[_ngcontent-%COMP%], .btn-delete[_ngcontent-%COMP%], .btn-deactivate[_ngcontent-%COMP%]{width:24px;height:24px;border:none;border-radius:2px;cursor:pointer;font-size:12px;display:flex;align-items:center;justify-content:center}.btn-close[_ngcontent-%COMP%]:hover, .btn-delete[_ngcontent-%COMP%]:hover, .btn-deactivate[_ngcontent-%COMP%]:hover{opacity:.7}.btn-close[_ngcontent-%COMP%]{background:#dc3545;color:#fff}.btn-delete[_ngcontent-%COMP%]{background:#6c757d;color:#fff}.btn-deactivate[_ngcontent-%COMP%]{background:#ffc107;color:#212529}.text-input[_ngcontent-%COMP%]{line-height:inherit;vertical-align:top;text-align:left;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.text-editor-container.dragging[_ngcontent-%COMP%]   .text-input[_ngcontent-%COMP%], .text-editor-container.resizing[_ngcontent-%COMP%]   .text-input[_ngcontent-%COMP%], .text-editor-container.rotating[_ngcontent-%COMP%]   .text-input[_ngcontent-%COMP%]{pointer-events:none;-webkit-user-select:none;user-select:none}.text-editor-container.dragging[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{opacity:.5;background:#414141;cursor:grabbing}.text-editor-container.rotating[_ngcontent-%COMP%]   .rotate-handle[_ngcontent-%COMP%]{opacity:1;background:#e0a800;cursor:grabbing}.text-editor-container.selected[_ngcontent-%COMP%]   .resize-handle[_ngcontent-%COMP%], .text-editor-container.selected[_ngcontent-%COMP%]   .rotate-handle[_ngcontent-%COMP%], .text-editor-container.selected[_ngcontent-%COMP%]   .control-panel[_ngcontent-%COMP%], .text-editor-container.selected[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{opacity:1}"]})};export{yt as a,_t as b,St as c,Tt as d,tt as e,wt as f};
